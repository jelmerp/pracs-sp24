<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.549">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Jelmer Poelstra">
<meta name="dcterms.date" content="2024-04-16">

<title>PRACS24: week 7 lecture</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/quarto-contrib/fontawesome6-0.1.0/all.css" rel="stylesheet">
<link href="../site_libs/quarto-contrib/fontawesome6-0.1.0/latex-fontsize.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">pracs-sp24</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-week-overviews" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Week overviews</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-week-overviews">    
        <li>
    <a class="dropdown-item" href="../week0/overview.html">
 <span class="dropdown-text">Pre-course</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../week1/w1_overview.html">
 <span class="dropdown-text">Week 1: Course intro, OSC and shell basics</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../week2/w2_overview.html">
 <span class="dropdown-text">Week 2: Project organization, Markdown &amp; files in the shell</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../week3/w3_overview.html">
 <span class="dropdown-text">Week 3: Git and GitHub</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../week4/w4_overview.html">
 <span class="dropdown-text">Week 4: Shell script and CLI tools</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../week5/w5_overview.html">
 <span class="dropdown-text">Week 5: Software and batch jobs at OSC</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../week6/w6_overview.html">
 <span class="dropdown-text">Week 6: Pipelines</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../week7/w7_overview.html">
 <span class="dropdown-text">Week 7: Course recap</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-lectures-i" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Lectures I</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-lectures-i">    
        <li class="dropdown-header">Week 1: Unix shell</li>
        <li>
    <a class="dropdown-item" href="../week1/w1_course-intro.html">
 <span class="dropdown-text">I: Course Intro (slides)</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../week1/w1_osc.html">
 <span class="dropdown-text">II: OSC Intro</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../week1/w1_shell.html">
 <span class="dropdown-text">III: Shell basics</span></a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li class="dropdown-header">Week 2: Project organization</li>
        <li>
    <a class="dropdown-item" href="../week2/w2_project-org.html">
 <span class="dropdown-text">I: Project organization</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../week2/w2_vscode-markdown.html">
 <span class="dropdown-text">II: VS Code &amp; Markdown</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../week2/w2_shellfiles.html">
 <span class="dropdown-text">III: Managing files in the shell</span></a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li class="dropdown-header">Week 3: Git</li>
        <li>
    <a class="dropdown-item" href="../week3/w3_git1.html">
 <span class="dropdown-text">I: Getting started with Git</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../week3/w3_git2.html">
 <span class="dropdown-text">II: Git remotes on GitHub</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../week3/w3_git3.html">
 <span class="dropdown-text"><em>(Bonus: Branching, collaborating, and undoing)</em></span></a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li class="dropdown-header">Week 4: Shell scripts</li>
        <li>
    <a class="dropdown-item" href="../week4/w4_1_scripts.html">
 <span class="dropdown-text">I: Shell scripts</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../week4/w4_2_cli-tools.html">
 <span class="dropdown-text">II: Running CLI tools with shell scripts</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../week4/w4_3_bonus.html">
 <span class="dropdown-text"><em>(Bonus: while loops, arrays, and more)</em></span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-lectures-ii" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Lectures II</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-lectures-ii">    
        <li class="dropdown-header">Week 5: Software and batch jobs at OSC</li>
        <li>
    <a class="dropdown-item" href="../week5/w5_1_osc.html">
 <span class="dropdown-text">I: A closer look at OSC</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../week5/w5_2_software.html">
 <span class="dropdown-text">II: Using software at OSC</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../week5/w5_3_slurm.html">
 <span class="dropdown-text">III: Slurm batch jobs</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../week5/w5_bonus_ssh.html">
 <span class="dropdown-text"><em>(Bonus: Connecting with SSH)</em></span></a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li class="dropdown-header">Week 6: Runner scripts and pipelines</li>
        <li>
    <a class="dropdown-item" href="../week6/w6_1_pipelines.html">
 <span class="dropdown-text">I: Runner scripts and pipelines</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../week6/w6_2_nfcore.html">
 <span class="dropdown-text">II: Running an nf-core Nextflow pipeline</span></a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li class="dropdown-header">Week 7: Course recap</li>
        <li>
    <a class="dropdown-item" href="../week7/w7_1.html">
 <span class="dropdown-text">Course recap &amp; File transfer</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-homework" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Homework</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-homework">    
        <li class="dropdown-header">Exercises</li>
        <li>
    <a class="dropdown-item" href="../week1/w1_exercises.html">
 <span class="dropdown-text">Week 1: Shell basics</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../week2/w2_exercises.html">
 <span class="dropdown-text">Week 2: Markdown and files in the shell</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../week3/w3_exercises.html">
 <span class="dropdown-text">Week 3: Git and GitHub</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../week4/w4_exercises.html">
 <span class="dropdown-text">Week 4: Shell scripts and CLI tools</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../week5/w5_exercises.html">
 <span class="dropdown-text">Week 5: Software and batch jobs at OSC</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../week6/w6_exercises.html">
 <span class="dropdown-text">Week 6: Runner scripts and pipelines</span></a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li class="dropdown-header">Assignments</li>
        <li>
    <a class="dropdown-item" href="../week0/osc-setup.html">
 <span class="dropdown-text">Pre-course: OSC account setup</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../week2/w2_github-account.html">
 <span class="dropdown-text">Week 2: GitHub account</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-final-project" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Final project</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-final-project">    
        <li>
    <a class="dropdown-item" href="../finalproj/info.html">
 <span class="dropdown-text">General info</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../finalproj/proposal.html">
 <span class="dropdown-text">I: Proposal (Due Apr 8)</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../finalproj/presentation.html">
 <span class="dropdown-text">II: Oral presentation (Apr 16 &amp; 18)</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../finalproj/submission.html">
 <span class="dropdown-text">III: Final submission (Due Apr 29)</span></a>
  </li>  
    </ul>
  </li>
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-miscellaneous" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Miscellaneous</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-miscellaneous">    
        <li>
    <a class="dropdown-item" href="../about.html">
 <span class="dropdown-text">About this website</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../ref/glossary.html">
 <span class="dropdown-text">Course glossary</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../ref/shell.html">
 <span class="dropdown-text">Unix shell reference</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="https://osu.instructure.com/courses/163340"> 
<span class="menu-text"><i class="fa-solid fa-graduation-cap" aria-label="graduation-cap"></i></span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://ondemand.osc.edu"> 
<span class="menu-text"><i class="fa-solid fa-desktop" aria-label="desktop"></i></span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://library.ohio-state.edu/record=b8624007~S7"> 
<span class="menu-text"><i class="fa-solid fa-book" aria-label="book"></i></span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://library.ohio-state.edu/record=b9490023~S7"> 
<span class="menu-text"><i class="fa-solid fa-book-open" aria-label="book-open"></i></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
    <div class="dropdown">
      <a href="" title="" id="quarto-navigation-tool-dropdown-0" class="quarto-navigation-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false" aria-label=""><i class="bi bi-github"></i></a>
      <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="quarto-navigation-tool-dropdown-0">
          <li>
            <a class="dropdown-item quarto-navbar-tools-item" href="https://github.com/jelmerp/pracs-sp24">
            Source Code
            </a>
          </li>
          <li>
            <a class="dropdown-item quarto-navbar-tools-item" href="https://github.com/jelmerp/pracs-sp24/issues/new">
            Report an Issue
            </a>
          </li>
      </ul>
    </div>
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#brief-recap-of-what-you-learned-in-this-course" id="toc-brief-recap-of-what-you-learned-in-this-course" class="nav-link active" data-scroll-target="#brief-recap-of-what-you-learned-in-this-course"><span class="header-section-number">1</span> Brief recap of what you learned in this course</a></li>
  <li><a href="#miscellaneous-notes" id="toc-miscellaneous-notes" class="nav-link" data-scroll-target="#miscellaneous-notes"><span class="header-section-number">2</span> Miscellaneous notes</a>
  <ul class="collapse">
  <li><a href="#best-practices" id="toc-best-practices" class="nav-link" data-scroll-target="#best-practices"><span class="header-section-number">2.1</span> Best practices</a></li>
  <li><a href="#using-ssh-to-connect-to-osc" id="toc-using-ssh-to-connect-to-osc" class="nav-link" data-scroll-target="#using-ssh-to-connect-to-osc"><span class="header-section-number">2.2</span> Using SSH to connect to OSC</a></li>
  </ul></li>
  <li><a href="#file-transfer-to-and-from-osc-with-filezilla" id="toc-file-transfer-to-and-from-osc-with-filezilla" class="nav-link" data-scroll-target="#file-transfer-to-and-from-osc-with-filezilla"><span class="header-section-number">3</span> File transfer to and from OSC with FileZilla</a></li>
  <li><a href="#downloading-files-at-the-command-line" id="toc-downloading-files-at-the-command-line" class="nav-link" data-scroll-target="#downloading-files-at-the-command-line"><span class="header-section-number">4</span> Downloading files at the command line</a>
  <ul class="collapse">
  <li><a href="#wget" id="toc-wget" class="nav-link" data-scroll-target="#wget"><span class="header-section-number">4.1</span> <code>wget</code></a></li>
  <li><a href="#other-genomic-downloads" id="toc-other-genomic-downloads" class="nav-link" data-scroll-target="#other-genomic-downloads"><span class="header-section-number">4.2</span> Other genomic downloads</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Course recap and file transfer</h1>
<p class="subtitle lead">Week 7</p>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Jelmer Poelstra </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">April 16, 2024</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<hr>
<p><br></p>
<section id="brief-recap-of-what-you-learned-in-this-course" class="level2" data-number="1">
<h2 data-number="1" class="anchored" data-anchor-id="brief-recap-of-what-you-learned-in-this-course"><span class="header-section-number">1</span> Brief recap of what you learned in this course</h2>
<p>In this course, you have learned to:</p>
<ul>
<li>Work in the Unix shell and use a variety of Unix commands</li>
<li>Write simple but flexible shell scripts that use a set of best practices and accept arguments</li>
<li>Run (bioinformatics) tools with CLIs, command-line interfaces</li>
<li>Understand the basics of a supercomputer and get comfortable working with one (OSC)</li>
<li>Use Conda to install and manage software environments</li>
<li>Submit shell scripts as Slurm batch jobs</li>
<li>Use the VS Code text editor as an IDE for shell code</li>
<li>Write informal pipelines using runner scripts</li>
<li>Use formal Nextflow/nf-core pipelines</li>
<li>Structure your research project files in a consistent way that favors reproducibility</li>
<li>Write in Markdown, for example to create README and notes files to document your research</li>
<li>Use Git to version control your research project code and share this code with GitHub</li>
</ul>
<p>As also mentioned in the introductory presentation, these skills should:</p>
<ul>
<li>Help you to do your research more reproducibly and efficiently</li>
<li>Prepare you to work with large “omics” datasets</li>
</ul>
<p><br></p>
</section>
<section id="miscellaneous-notes" class="level2" data-number="2">
<h2 data-number="2" class="anchored" data-anchor-id="miscellaneous-notes"><span class="header-section-number">2</span> Miscellaneous notes</h2>
<section id="best-practices" class="level3" data-number="2.1">
<h3 data-number="2.1" class="anchored" data-anchor-id="best-practices"><span class="header-section-number">2.1</span> Best practices</h3>
<section id="script-arguments-and-hard-coding" class="level4">
<h4 class="anchored" data-anchor-id="script-arguments-and-hard-coding">Script arguments and hard-coding</h4>
<p>We’ve been writing shell scripts that accept arguments, instead of including variable things like inputs and outputs in the scripts themselves. The latter method can be referred to as “hard-coding” these items.</p>
<p>You can use arguments also for things like settings, for example for bioinformatics program options that may you may want to vary among different runs of the script, or for information about your data like read length or RNA-seq library strandedness (as you did in last week’s exercises). If you don’t hard-code these options in your script but have arguments for them, it will be easier to re-use your script in different contexts.</p>
<p>But there is balance to be struck here, and you can also “hobble” your script with a confusing array of arguably too many arguments. Along those lines, here are two things to consider:</p>
<ul>
<li><p>When you do hard-code potentially variable things in your script, it can be a good idea to define them clearly <strong>at the top of your script</strong>. We actually did this in our primary script to run the nf-core rnaseq pipeline, where we had the following lines to define a variable with the location of the workflow dir:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Settings and constants</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="va">WORKFLOW_DIR</span><span class="op">=</span>software/nfc-rnaseq/3_14_0</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Such variables can be referred to as “constants”, since they are hard-coded in the script, and in shell code, ALL-CAPS is regularly used for them<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>.</p></li>
<li><p>It is also possible to make your shell script accept <em>options</em>. The example below uses both long and short options (e.g.&nbsp;<code>-o | --outdir</code>). It also used “flag” options that turn functionality on/off (e.g.&nbsp;<code>--no_gcbias</code>) and options that take arguments (e.g.&nbsp;<code>--infile</code>).</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Process command-line options</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> <span class="bu">[</span> <span class="st">"</span><span class="va">$1</span><span class="st">"</span> <span class="ot">!=</span> <span class="st">""</span> <span class="bu">]</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">case</span> <span class="st">"</span><span class="va">$1</span><span class="st">"</span> <span class="kw">in</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>        <span class="ss">-o</span> <span class="kw">|</span> <span class="ss">--outdir</span> <span class="kw">)</span>     <span class="bu">shift</span> <span class="kw">&amp;&amp;</span> <span class="va">outdir</span><span class="op">=</span><span class="va">$1</span> <span class="cf">;;</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>        <span class="ss">-i</span> <span class="kw">|</span> <span class="ss">--infile</span> <span class="kw">)</span>     <span class="bu">shift</span> <span class="kw">&amp;&amp;</span> <span class="va">infile</span><span class="op">=</span><span class="va">$1</span> <span class="cf">;;</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>        <span class="ss">--transcripts</span> <span class="kw">)</span>     <span class="bu">shift</span> <span class="kw">&amp;&amp;</span> <span class="va">transcripts</span><span class="op">=</span><span class="va">$1</span> <span class="cf">;;</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>        <span class="ss">--no_gcbias</span> <span class="kw">)</span>       <span class="va">gcbias</span><span class="op">=</span>false <span class="cf">;;</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>        <span class="ss">--dl_container</span> <span class="kw">)</span>    <span class="va">dl_container</span><span class="op">=</span>true <span class="cf">;;</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>        <span class="ss">-h</span> <span class="kw">|</span> <span class="ss">--help</span> <span class="kw">)</span>       <span class="ex">script_help</span><span class="kw">;</span> <span class="bu">exit</span> 0 <span class="cf">;;</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>        <span class="ss">-v</span> <span class="kw">|</span> <span class="ss">--version</span> <span class="kw">)</span>    <span class="bu">echo</span> <span class="st">"Version 2024-04-13"</span> <span class="kw">&amp;&amp;</span> <span class="bu">exit</span> 0 <span class="cf">;;</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>        <span class="pp">*</span> <span class="kw">)</span>                 <span class="bu">echo</span> <span class="st">"Invalid option </span><span class="va">$1</span><span class="st">"</span> <span class="kw">&amp;&amp;</span> <span class="bu">exit</span> 1 <span class="cf">;;</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">esac</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>    <span class="bu">shift</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Such a script could for example be run like so:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="ex">sbatch</span> scripts/salmon.sh <span class="at">-i</span> my.bam <span class="at">-o</span> results/salmon <span class="at">--no_gcbias</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>That’s more readable less error-prone than “anonymous” positional arguments. It also makes it possible to add several/many settings that have defaults — when a script only takes arguments, all of them always need to be provided.</p></li>
</ul>
<hr style="height:1pt; visibility:hidden;">
</section>
<section id="program-versions" class="level4">
<h4 class="anchored" data-anchor-id="program-versions">Program versions</h4>
<p>Here is one small best-practice addition to shell scripts that was used in last week’s exercises, which I also wanted to point out here (you may want to use this in your final project!). For scripts that run bioinformatics tools, it’s a good idea <strong>include a line to print the program version</strong>. For example, the FastQC script contained the following lines at the end:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">"# Used FastQC version:"</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="ex">fastqc</span> <span class="at">--version</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>This way you’ll always have a clear record of the version that you used when you ran the script, at least if you keep the Slurm log file (and in last week’s exercises, we additionally moved Slurm log files to a <code>logs</code> dir within the output dir).</p>
<hr style="height:1pt; visibility:hidden;">
</section>
</section>
<section id="using-ssh-to-connect-to-osc" class="level3" data-number="2.2">
<h3 data-number="2.2" class="anchored" data-anchor-id="using-ssh-to-connect-to-osc"><span class="header-section-number">2.2</span> Using SSH to connect to OSC</h3>
<p>Because OSC’s OnDemand web portal is so useful, we have been exclusively using that to connect to OSC. But not all supercomputers have such a web portal, and the classic way of connecting to supercomputers and other remote computers is using SSH (Secure SHell). You can also connect to OSC with SSH, and this can be a faster way than going through OnDemand when you’re comfortable in the Unix shell.</p>
<p>At least with a Mac or Linux computer, you just have to open a shell on your own computer and use the <code>ssh</code> command to “move your shell” to OSC:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ssh</span> jelmer@pitzer.osc.edu</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre class="bash-out"><code>jelmer@pitzer.osc.edu's password:</code></pre>
<p>I have added a <a href="../week5/w5_bonus_ssh.html">page with more information on connecting to OSC with SSH</a>, which also includes information to:</p>
<ul>
<li>Avoid being prompted for your password every time you connect</li>
<li>SSH-tunnel a local VS Code installation to OSC (!!)</li>
</ul>
<p><br></p>
</section>
</section>
<section id="file-transfer-to-and-from-osc-with-filezilla" class="level2" data-number="3">
<h2 data-number="3" class="anchored" data-anchor-id="file-transfer-to-and-from-osc-with-filezilla"><span class="header-section-number">3</span> File transfer to and from OSC with FileZilla</h2>
<p>In week 5, I had added some self-study material about file transfer to and from OSC at the <a href="../week5/w5_1_osc.html#self-study-material-more-on-file-transfer">bottom of the lecture page on OSC</a>. This material covers:</p>
<ul>
<li>Remote transfer commands like <code>scp</code> and <code>rsync</code> <em>(for small transfers)</em></li>
<li>SFTP, focusing on command-line usage <em>(for transfers of any size)</em></li>
<li>Globus (briefly) <em>(for large transfers)</em></li>
</ul>
<p>Here, let’s briefly go over what it probably overall the single best way to transfer files, since it works for transfers of any size, and is easy and quick: <strong>file transfer with a GUI-based SFTP client</strong>. There are a number of such programs, but I chose to show you <strong>FileZilla</strong> because it works on all operating systems<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a>.</p>
<ul>
<li><p>Go to the <a href="https://filezilla-project.org/download.php?type=client">FileZilla download page</a> — it should automatically display a big green download button for your operating system: click that and install and open the program.</p></li>
<li><p>To connect to OSC, find the Site Manager: click <code>File</code> in the top menu bar and then <code>Site Manager</code><a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a>. In the Site Manager:</p>
<ul>
<li>Protocol: select “SFTP - SSH File Transfer Protocol”.</li>
<li>Host: type <code>sftp.osc.edu</code> (and you can leave the Port box empty).</li>
<li>Logon Type: Make sure “Normal” is selected.</li>
<li>User: Type you OSC user name.</li>
<li>Password: Type or copy your OSC password.</li>
<li>Click the “Connect” button at the bottom to connect to OSC.</li>
</ul></li>
</ul>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/filezilla_connect.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:60.0%"></p>
</figure>
</div>
<ul>
<li>Once connected, your main screen is split with a local file explorer on the left, and a remote file explorer on the right:</li>
</ul>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/split_screen.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:90.0%"></p>
</figure>
</div>
<ul>
<li><p>Transferring dirs and files in either direction is as simple as dragging and dropping them to the other side!</p></li>
<li><p>Your default location at OSC is your home dir in <code>/users/</code>, but you can type a path in the top bar to e.g.&nbsp;go to <code>/fs/ess/PAS2700/users</code>:</p></li>
</ul>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/proj_dir.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:70.0%"></p>
</figure>
</div>
<p><br></p>
</section>
<section id="downloading-files-at-the-command-line" class="level2" data-number="4">
<h2 data-number="4" class="anchored" data-anchor-id="downloading-files-at-the-command-line"><span class="header-section-number">4</span> Downloading files at the command line</h2>
<p>When you need to get large files from public repositories like the NCBI (e.g.&nbsp;reference genome files, raw reads from the SRA), I would recommend not to download these to your own computer and then transfer them to OSC, but to download them directly to OSC using commands.</p>
<section id="wget" class="level3" data-number="4.1">
<h3 data-number="4.1" class="anchored" data-anchor-id="wget"><span class="header-section-number">4.1</span> <code>wget</code></h3>
<p>You can download files from any URL that will allow you using the <code>wget</code> command. It has many options, but basic usage is quite simple:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># This will download the file at the URL to your current working dir</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="fu">wget</span> <span class="op">&lt;</span>URL<span class="op">&gt;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>As an example, say that we want to download the reference genome FASTA and GTF files for <em>Culex pipiens</em>, the focal species of the Garrigos et al.&nbsp;RNA-seq data set that we’ve been working with. The files for that genome can be found at this <a href="https://ftp.ncbi.nlm.nih.gov/genomes/all/GCA/016/801/865/GCA_016801865.2_TS_CPP_V2/">NCBI FTP webpage</a>.</p>
<p>You can right-click on any of the files and then click “Copy Link Address” (or something similar, depending on your browser) — let’s copy the URL to the assembly FASTA (<code>.fna.gz</code>) file. Then type <code>wget</code> and <kbd>Space</kbd> in your terminal and paste the URL:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">wget</span> https://ftp.ncbi.nlm.nih.gov/genomes/all/GCA/016/801/865/GCA_016801865.2_TS_CPP_V2/GCA_016801865.2_TS_CPP_V2_genomic.fna.gz</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre class="bash-out"><code>--2024-04-13 13:33:16--  https://ftp.ncbi.nlm.nih.gov/genomes/all/GCA/016/801/865/GCA_016801865.2_TS_CPP_V2/GCA_016801865.2_TS_CPP_V2_genomic.fna.gz
Resolving ftp.ncbi.nlm.nih.gov (ftp.ncbi.nlm.nih.gov)... 130.14.250.12, 130.14.250.11, 2607:f220:41e:250::12, ...
Connecting to ftp.ncbi.nlm.nih.gov (ftp.ncbi.nlm.nih.gov)|130.14.250.12|:443... connected.
HTTP request sent, awaiting response... 200 OK
Length: 172895917 (165M) [application/x-gzip]
Saving to: ‘GCA_016801865.2_TS_CPP_V2_genomic.fna.gz’

100%[=====================================================================================================================&gt;] 172,895,917 51.7MB/s   in 3.2s   

2024-04-13 13:33:20 (51.7 MB/s) - ‘GCA_016801865.2_TS_CPP_V2_genomic.fna.gz’ saved [172895917/172895917]</code></pre>
<p>Let’s list our downloaded file:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ls</span> <span class="at">-lh</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre class="bash-out"><code>-rw-r--r--  1 jelmer PAS0471 165M Aug  5  2022 GCA_016801865.2_TS_CPP_V2_genomic.fna.gz</code></pre>
<hr style="height:1pt; visibility:hidden;">
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Another commonly used downloading command is <code>curl</code>
</div>
</div>
<div class="callout-body-container callout-body">
<p><code>wget</code> and <code>curl</code> have similar functionality, so you don’t really need to learn to use both of them.</p>
</div>
</div>
<hr style="height:1pt; visibility:hidden;">
</section>
<section id="other-genomic-downloads" class="level3" data-number="4.2">
<h3 data-number="4.2" class="anchored" data-anchor-id="other-genomic-downloads"><span class="header-section-number">4.2</span> Other genomic downloads</h3>
<ul>
<li><p>For reference genome downloads, NCBI also has a relatively new and very useful tool called <strong>“datasets”</strong>. This is especially useful if you want to download multiple or many genomes — for example, you can download all available genomes of a certain (say, bacterial) genus with a single command.</p></li>
<li><p>For downloads from the Sequence Read Archive (SRA), which contains high-throughput sequencing reads, you can use tools like <a href="https://github.com/ncbi/sra-tools/wiki/HowTo:-fasterq-dump">fasterq-dump</a> and <a href="https://github.com/rpetit3/fastq-dl">dl-fastq</a>. Also handy is the simple <a href="https://sra-explorer.info">SRA explorer website</a>, where you can enter an NCBI accession number and it will give you download links.</p></li>
</ul>
<p><br><br></p>


</section>
</section>


<a onclick="window.scrollTo(0, 0); return false;" role="button" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a><div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p> But this is far from universal, it is also fairly common to use all-caps for all shell variables, but this is not what we’ve been doing.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p> And has a more intuitive user interface than CyberDuck, another very commonly used program that works both on Mac and Windows.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3"><p> There is a also an icon in the far top-left to access this menu. Additionally, there is a “Quickconnect” bar but I’ve not managed to connect to OSC with that.<a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>2024, Jelmer Poelstra</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/jelmerp/pracs-sp24">
      <i class="bi bi-github" role="img">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>




</body></html>