<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.549">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Jelmer Poelstra">
<meta name="dcterms.date" content="2024-04-11">

<title>PRACS24: week 6 exercises</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/quarto-contrib/fontawesome6-0.1.0/all.css" rel="stylesheet">
<link href="../site_libs/quarto-contrib/fontawesome6-0.1.0/latex-fontsize.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">pracs-sp24</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-week-overviews" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Week overviews</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-week-overviews">    
        <li>
    <a class="dropdown-item" href="../week0/overview.html">
 <span class="dropdown-text">Pre-course</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../week1/w1_overview.html">
 <span class="dropdown-text">Week 1: Course intro, OSC and shell basics</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../week2/w2_overview.html">
 <span class="dropdown-text">Week 2: Project organization, Markdown &amp; files in the shell</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../week4/w4_overview.html">
 <span class="dropdown-text">Week 3: Git and GitHub</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../week4/w4_overview.html">
 <span class="dropdown-text">Week 4: Shell script and CLI tools</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../week5/w5_overview.html">
 <span class="dropdown-text">Week 5: Software and batch jobs at OSC</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../week6/w6_overview.html">
 <span class="dropdown-text">Week 6: Pipelines</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../week7/w7_overview.html">
 <span class="dropdown-text">Week 7: Course recap</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-lectures-i" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Lectures I</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-lectures-i">    
        <li class="dropdown-header">Week 1: Unix shell</li>
        <li>
    <a class="dropdown-item" href="../week1/w1_course-intro.html">
 <span class="dropdown-text">I: Course Intro (slides)</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../week1/w1_osc.html">
 <span class="dropdown-text">II: OSC Intro</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../week1/w1_shell.html">
 <span class="dropdown-text">III: Shell basics</span></a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li class="dropdown-header">Week 2: Project organization</li>
        <li>
    <a class="dropdown-item" href="../week2/w2_project-org.html">
 <span class="dropdown-text">I: Project organization</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../week2/w2_vscode-markdown.html">
 <span class="dropdown-text">II: VS Code &amp; Markdown</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../week2/w2_shellfiles.html">
 <span class="dropdown-text">III: Managing files in the shell</span></a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li class="dropdown-header">Week 3: Git</li>
        <li>
    <a class="dropdown-item" href="../week3/w3_git1.html">
 <span class="dropdown-text">I: Getting started with Git</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../week3/w3_git2.html">
 <span class="dropdown-text">II: Git remotes on GitHub</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../week3/w3_git3.html">
 <span class="dropdown-text"><em>(Git bonus material)</em></span></a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li class="dropdown-header">Week 4: Shell scripts</li>
        <li>
    <a class="dropdown-item" href="../week4/w4_1_scripts.html">
 <span class="dropdown-text">I: Shell scripts</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../week4/w4_2_cli-tools.html">
 <span class="dropdown-text">II: Running CLI tools with shell scripts</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../week4/w4_3_bonus.html">
 <span class="dropdown-text"><em>(Scripts bonus material)</em></span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-lectures-ii" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Lectures II</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-lectures-ii">    
        <li class="dropdown-header">Week 5: Software and batch jobs at OSC</li>
        <li>
    <a class="dropdown-item" href="../week5/w5_1_osc.html">
 <span class="dropdown-text">I: A closer look at OSC</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../week5/w5_2_software.html">
 <span class="dropdown-text">II: Using software at OSC</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../week5/w5_3_slurm.html">
 <span class="dropdown-text">III: Slurm batch jobs</span></a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li class="dropdown-header">Week 6: Pipelines</li>
        <li>
    <a class="dropdown-item" href="../week6/w6_1_pipelines.html">
 <span class="dropdown-text">I: Runner scripts and pipelines</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../week6/w6_2_nfcore.html">
 <span class="dropdown-text">II: Running an nf-core Nextflow pipeline</span></a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li class="dropdown-header">Week 7: Course recap</li>
        <li>
    <a class="dropdown-item" href="../week7/w7_1.html">
 <span class="dropdown-text">Course recap &amp; [TBA]</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-homework" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Homework</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-homework">    
        <li class="dropdown-header">Exercises</li>
        <li>
    <a class="dropdown-item" href="../week1/w1_exercises.html">
 <span class="dropdown-text">Week 1: Shell basics</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../week2/w2_exercises.html">
 <span class="dropdown-text">Week 2: Markdown and files in the shell</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../week3/w3_exercises.html">
 <span class="dropdown-text">Week 3: Git and GitHub</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../week4/w4_exercises.html">
 <span class="dropdown-text">Week 4: Shell scripts and CLI tools</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../week5/w5_exercises.html">
 <span class="dropdown-text">Week 5: Software and batch jobs at OSC</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../week6/w6_exercises.html">
 <span class="dropdown-text">Week 6: Pipelines</span></a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li class="dropdown-header">Assignments</li>
        <li>
    <a class="dropdown-item" href="../week0/osc-setup.html">
 <span class="dropdown-text">Pre-course: OSC account setup</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../week2/w2_github-account.html">
 <span class="dropdown-text">Week 2: GitHub account</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-final-project" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Final project</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-final-project">    
        <li>
    <a class="dropdown-item" href="../finalproj/info.html">
 <span class="dropdown-text">General info</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../finalproj/proposal.html">
 <span class="dropdown-text">I: Proposal (Due Apr 8)</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../finalproj/presentation.html">
 <span class="dropdown-text">II: Oral presentation (Apr 16 &amp; 18)</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../finalproj/submission.html">
 <span class="dropdown-text">III: Final submission (Due Apr 29)</span></a>
  </li>  
    </ul>
  </li>
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-miscellaneous" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Miscellaneous</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-miscellaneous">    
        <li>
    <a class="dropdown-item" href="../about.html">
 <span class="dropdown-text">About this website</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../ref/glossary.html">
 <span class="dropdown-text">Course glossary</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../ref/shell.html">
 <span class="dropdown-text">Unix shell reference</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="https://osu.instructure.com/courses/163340"> 
<span class="menu-text"><i class="fa-solid fa-graduation-cap" aria-label="graduation-cap"></i></span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://ondemand.osc.edu"> 
<span class="menu-text"><i class="fa-solid fa-desktop" aria-label="desktop"></i></span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://library.ohio-state.edu/record=b8624007~S7"> 
<span class="menu-text"><i class="fa-solid fa-book" aria-label="book"></i></span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://library.ohio-state.edu/record=b9490023~S7"> 
<span class="menu-text"><i class="fa-solid fa-book-open" aria-label="book-open"></i></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
    <div class="dropdown">
      <a href="" title="" id="quarto-navigation-tool-dropdown-0" class="quarto-navigation-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false" aria-label=""><i class="bi bi-github"></i></a>
      <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="quarto-navigation-tool-dropdown-0">
          <li>
            <a class="dropdown-item quarto-navbar-tools-item" href="https://github.com/jelmerp/pracs-sp24">
            Source Code
            </a>
          </li>
          <li>
            <a class="dropdown-item quarto-navbar-tools-item" href="https://github.com/jelmerp/pracs-sp24/issues/new">
            Report an Issue
            </a>
          </li>
      </ul>
    </div>
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#introduction-and-setting-up" id="toc-introduction-and-setting-up" class="nav-link active" data-scroll-target="#introduction-and-setting-up">Introduction and setting up</a>
  <ul class="collapse">
  <li><a href="#setting-up" id="toc-setting-up" class="nav-link" data-scroll-target="#setting-up">Setting up</a></li>
  </ul></li>
  <li><a href="#exercise-1-align-reads-with-star" id="toc-exercise-1-align-reads-with-star" class="nav-link" data-scroll-target="#exercise-1-align-reads-with-star">Exercise 1: Align reads with STAR</a></li>
  <li><a href="#exercise-2-quantify-gene-counts-with-salmon" id="toc-exercise-2-quantify-gene-counts-with-salmon" class="nav-link" data-scroll-target="#exercise-2-quantify-gene-counts-with-salmon">Exercise 2: Quantify gene counts with Salmon</a></li>
  <li><a href="#exercise-3-summarize-qc-metrics-with-multiqc" id="toc-exercise-3-summarize-qc-metrics-with-multiqc" class="nav-link" data-scroll-target="#exercise-3-summarize-qc-metrics-with-multiqc">Exercise 3: Summarize QC metrics with MultiQC</a></li>
  <li><a href="#exercise-4-ponder-your-runner-script" id="toc-exercise-4-ponder-your-runner-script" class="nav-link" data-scroll-target="#exercise-4-ponder-your-runner-script">Exercise 4: Ponder your runner script</a></li>
  <li><a href="#solutions" id="toc-solutions" class="nav-link" data-scroll-target="#solutions">Solutions</a>
  <ul class="collapse">
  <li><a href="#exercise-1" id="toc-exercise-1" class="nav-link" data-scroll-target="#exercise-1">Exercise 1</a></li>
  <li><a href="#exercise-2" id="toc-exercise-2" class="nav-link" data-scroll-target="#exercise-2">Exercise 2</a></li>
  <li><a href="#exercise-3" id="toc-exercise-3" class="nav-link" data-scroll-target="#exercise-3">Exercise 3</a></li>
  <li><a href="#exercise-4" id="toc-exercise-4" class="nav-link" data-scroll-target="#exercise-4">Exercise 4</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Week 6 exercises</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Jelmer Poelstra </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">April 11, 2024</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
This page is still under construction.
</div>
</div>
<div class="callout-body-container callout-body">

</div>
</div>
<hr>
<p><br></p>
<section id="introduction-and-setting-up" class="level2">
<h2 class="anchored" data-anchor-id="introduction-and-setting-up">Introduction and setting up</h2>
<p>These exercises mainly serve to practice more with organizing your scripts according to the strategy of using:</p>
<ul>
<li>Primary shell scripts that typically run a single bioinformatics tool for a single file or sample, and that accept e.g.&nbsp;a file name as an argument.</li>
<li>A runner script that serves as an informal pipeline: it mainly contains code to run all the primary scripts, typically submitting those as batch jobs, and often using loops to do so.</li>
</ul>
<p>From last week, you already have primary scripts and runner script code to run FastQC and TrimGalore, and have used these to pre-process the Garrigos et al.&nbsp;RNA-seq reads. Here, you’ll add a few steps so that your runner script will more closely resemble something you might use in this course’s final project, or your research projects: it will be larger than the previous ones and will also contain consecutive steps, where the input of one step is the output of a previous step.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Primary script code
</div>
</div>
<div class="callout-body-container callout-body">
<p>For your convenience, I will provide the scripts from last week, and there are also hints with the contents of the additional primary scripts. You should feel free to copy the latter as well if you run out of time, <em>so you are still able to think about and write your runner script,</em> <em>which is the main point of these exercises</em>.</p>
</div>
</div>
<hr style="height:1pt; visibility:hidden;">
<section id="setting-up" class="level3">
<h3 class="anchored" data-anchor-id="setting-up">Setting up</h3>
<ul>
<li><p>Create and move into a dir for the exercises:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># You should be in /fs/ess/PAS2700/users/$USER</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> week06/exercises</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> week06/exercises</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p>Create dirs for primary scripts and for a runner script, the create the runner script and open it:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> scripts run</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">touch</span> run/run.sh</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p>At the top of the runner script, add the following short description of what it does (modify the date, your name, and the path as needed):</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 2024-04-11, Jelmer Poelstra</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="co"># - A runner script to run a simple RNA-seq analysis, creating a gene count table</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co">#   from RNA-seq reads and a reference genome assembly and annotation.</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="co"># - The steps are read QC and trimming, alignment, and quantification.</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co"># - The working dir is /fs/ess/PAS2700/users/jelmer/week06/exercises.</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="co"># - I am working on the OSC Pitzer cluster.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p>Copy the primary scripts:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cp</span> <span class="at">-v</span> XX scripts/</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre class="bash-out"><code>TODO</code></pre></li>
<li><p>Additionally, your runner script from last week’s exercises (<code>../../week05/exercsises/run/run.sh</code>) should have the loops to run submit these scripts for all samples. To make things easier, I’ve copied that code below — copy and paste this into your current <code>run/run.sh</code> script:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 1: Run FastQC for all FASTQ files</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> fastq_file <span class="kw">in</span> ../../garrigos_data/fastq/<span class="pp">*</span>fastq.gz<span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>    <span class="ex">sbatch</span> scripts/fastqc.sh <span class="st">"</span><span class="va">$fastq_file</span><span class="st">"</span> results/fastqc</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 2: Run TrimGalore for all FASTQ files</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> R1 <span class="kw">in</span> ../../garrigos_data/fastq/<span class="pp">*</span>_R1.fastq.gz<span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>    <span class="ex">sbatch</span> scripts/trimgalore.sh <span class="st">"</span><span class="va">$R1</span><span class="st">"</span> results/trimgalore</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
</ul>
<p><br></p>
</section>
</section>
<section id="exercise-1-align-reads-with-star" class="level2">
<h2 class="anchored" data-anchor-id="exercise-1-align-reads-with-star">Exercise 1: Align reads with STAR</h2>
<p>You will align (map) the <em>trimmed</em> reads to the reference genome with the program STAR, which is an aligner specifically designed for RNA-seq data<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>.</p>
<section id="a-index-the-reference-genomes" class="level4">
<h4 class="anchored" data-anchor-id="a-index-the-reference-genomes">A: Index the reference genomes</h4>
<p>When aligning reads, the first step is nearly always to create an index of the reference genome<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a>. The script <code>scripts/star_index.sh</code> that you already copied has the code to do this (also shown in the box below), and takes XXX arguments:</p>
<ol type="1">
<li>The reference genome</li>
<li>The output dir for the index files</li>
</ol>
<details>
<summary>
Click to see the code of the <code>star_index.sh</code> script
</summary>
<div class="sourceCode" id="cb7"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="ex">TODO</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<p><i class="fa-solid fa-user-edit" aria-label="user-edit"></i> In your runner script, write code to submit the <code>scripts/star_index.sh</code> as a batch job, passing the appropriate arguments to the script (note that your reference genome files are in <code>../../garrigos_data/ref</code>). Then submit the job, monitor its progress, and when its done, check the output files and move the Slurm log file to somewhere in the output dir.</p>
<hr style="height:1pt; visibility:hidden;">
</section>
<section id="b-align-the-reads" class="level4">
<h4 class="anchored" data-anchor-id="b-align-the-reads">B: Align the reads</h4>
<p>Now you can align the reads to the reference genome (index). The script <code>scripts/star_align.sh</code> does this for <em>one sample</em> (two FASTQ files, R1 and R2) at a time, and takes XX arguments:</p>
<ol type="1">
<li>An R1 FASTQ file</li>
<li>The reference genome index dir</li>
<li>An output dir (this can be the same for each sample)</li>
</ol>
<details>
<summary>
Click to see the code of the <code>star_align.sh</code> script
</summary>
<div class="sourceCode" id="cb8"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="ex">TODO</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<p><i class="fa-solid fa-user-edit" aria-label="user-edit"></i> In your runner script, write a <code>for</code> loop to submit a separate <code>scripts/star_align.sh</code> batch job for each sample. Then submit the jobs, monitor their progress, and when they are all done, check the output files and move the Slurm log files to somewhere in the output dir.</p>
<p><br></p>
</section>
</section>
<section id="exercise-2-quantify-gene-counts-with-salmon" class="level2">
<h2 class="anchored" data-anchor-id="exercise-2-quantify-gene-counts-with-salmon">Exercise 2: Quantify gene counts with Salmon</h2>
<p><br></p>
</section>
<section id="exercise-3-summarize-qc-metrics-with-multiqc" class="level2">
<h2 class="anchored" data-anchor-id="exercise-3-summarize-qc-metrics-with-multiqc">Exercise 3: Summarize QC metrics with MultiQC</h2>
<p><br></p>
</section>
<section id="exercise-4-ponder-your-runner-script" class="level2">
<h2 class="anchored" data-anchor-id="exercise-4-ponder-your-runner-script">Exercise 4: Ponder your runner script</h2>
<p><br></p>
</section>
<section id="solutions" class="level2">
<h2 class="anchored" data-anchor-id="solutions">Solutions</h2>
<section id="exercise-1" class="level3">
<h3 class="anchored" data-anchor-id="exercise-1">Exercise 1</h3>
<hr style="height:1pt; visibility:hidden;">
</section>
<section id="exercise-2" class="level3">
<h3 class="anchored" data-anchor-id="exercise-2">Exercise 2</h3>
<p>A</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span> slurm-star_index<span class="pp">*</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre class="bash-out"><code># Starting script star_index.sh
Thu Apr 11 13:44:02 EDT 2024
# Input assembly FASTA:   ../../garrigos_data/ref/GCF_016801865.2.fna
# Input annotation GTF:   ../../garrigos_data/ref/GCF_016801865.2.gtf
# Output dir:             results/star/index
# Numberr of threads:     16

        /fs/ess/PAS0471/jelmer/conda/star/bin/STAR-avx2 --runMode genomeGenerate --genomeFastaFiles ../../garrigos_data/ref/GCF_016801865.2.fna --sjdbGTFfile ../../garrigos_data/ref/GCF_016801865.2.gtf --genomeDir results/star/index --runThreadN 16
        STAR version: 2.7.11b   compiled: 2024-03-19T08:38:59+0000 :/opt/conda/conda-bld/star_1710837244939/work/source
Apr 11 13:44:03 ..... started STAR run
Apr 11 13:44:03 ... starting to generate Genome files
Apr 11 13:44:11 ..... processing annotations GTF
!!!!! WARNING: --genomeSAindexNbases 14 is too large for the genome size=566354144, which may cause seg-fault at the mapping step. Re-run genome generation with recommended --genomeSAindexNbases 13
Apr 11 13:44:16 ... starting to sort Suffix Array. This may take a long time...
Apr 11 13:44:18 ... sorting Suffix Array chunks and saving them to disk...
Apr 11 13:45:31 ... loading chunks from disk, packing SA...
Apr 11 13:45:43 ... finished generating suffix array
Apr 11 13:45:43 ... generating Suffix Array index
Apr 11 13:47:11 ... completed Suffix Array index
Apr 11 13:47:11 ..... inserting junctions into the genome indices
Apr 11 13:47:41 ... writing Genome to disk ...
Apr 11 13:47:41 ... writing Suffix Array to disk ...
Apr 11 13:47:43 ... writing SAindex to disk
Apr 11 13:47:43 ..... finished successfully

# Used STAR version:
2.7.11b
# Done with script star_index.sh
Thu Apr 11 13:47:44 EDT 2024</code></pre>
<hr style="height:1pt; visibility:hidden;">
</section>
<section id="exercise-3" class="level3">
<h3 class="anchored" data-anchor-id="exercise-3">Exercise 3</h3>
<hr style="height:1pt; visibility:hidden;">
</section>
<section id="exercise-4" class="level3">
<h3 class="anchored" data-anchor-id="exercise-4">Exercise 4</h3>
<p><br><br></p>


</section>
</section>


<a onclick="window.scrollTo(0, 0); return false;" role="button" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a><div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p> RNA-seq read alignment needs to be “splice-aware”: when the reads are mapped to the genome, introns are included in the reference but are (mostly) not present in the reads, as the reads are mostly mature mRNA with the introns spliced out. Therefore, a read may align as several disjunct fragments across introns!<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>The aligner will then align the reads to this index rather than the genome itself, which is much more efficient. These indices are aligner-specific, and can even differ among versions of the same aligner.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>2024, Jelmer Poelstra</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/jelmerp/pracs-sp24">
      <i class="bi bi-github" role="img">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>




</body></html>