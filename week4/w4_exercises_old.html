<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.549">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>PRACS24: Week 4 exercises</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/quarto-contrib/fontawesome6-0.1.0/all.css" rel="stylesheet">
<link href="../site_libs/quarto-contrib/fontawesome6-0.1.0/latex-fontsize.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">pracs-sp24</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-week-overviews" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Week overviews</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-week-overviews">    
        <li>
    <a class="dropdown-item" href="../week0/overview.html">
 <span class="dropdown-text">Pre-course</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../week1/w1_overview.html">
 <span class="dropdown-text">Week 1: Course intro, OSC and shell basics</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../week2/w2_overview.html">
 <span class="dropdown-text">Week 2: Project organization, Markdown &amp; files in the shell</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../week4/w4_overview.html">
 <span class="dropdown-text">Week 3: Git and GitHub</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../week4/w4_overview.html">
 <span class="dropdown-text">Week 4: Shell script and CLI tools</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-lectures" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Lectures</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-lectures">    
        <li class="dropdown-header">Week 1: Unix shell</li>
        <li>
    <a class="dropdown-item" href="../week1/w1_course-intro.html">
 <span class="dropdown-text">I: Course Intro (slides)</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../week1/w1_osc.html">
 <span class="dropdown-text">II: OSC Intro</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../week1/w1_shell.html">
 <span class="dropdown-text">III: Shell basics</span></a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li class="dropdown-header">Week 2: Project organization</li>
        <li>
    <a class="dropdown-item" href="../week2/w2_project-org.html">
 <span class="dropdown-text">I: Project organization</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../week2/w2_vscode-markdown.html">
 <span class="dropdown-text">II: VS Code &amp; Markdown</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../week2/w2_shellfiles.html">
 <span class="dropdown-text">III: Managing files in the shell</span></a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li class="dropdown-header">Week 3: Git</li>
        <li>
    <a class="dropdown-item" href="../week3/w3_git1.html">
 <span class="dropdown-text">I: Getting started with Git</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../week3/w3_git2.html">
 <span class="dropdown-text">II: Git remotes on GitHub</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../week3/w3_git3.html">
 <span class="dropdown-text">(Git bonus material)</span></a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li class="dropdown-header">Week 4: Shell scripts</li>
        <li>
    <a class="dropdown-item" href="../week4/w4_1_scripts.html">
 <span class="dropdown-text">I: Shell scripts</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../week4/w4_2_cli-tools.html">
 <span class="dropdown-text">II: Running CLI tools with shell scripts</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../week4/w4_3_bonus.html">
 <span class="dropdown-text">(Scripts bonus material)</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-homework" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Homework</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-homework">    
        <li class="dropdown-header">Exercises</li>
        <li>
    <a class="dropdown-item" href="../week1/w1_exercises.html">
 <span class="dropdown-text">Week 1: Shell basics</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../week2/w2_exercises.html">
 <span class="dropdown-text">Week 2: Markdown and files in the shell</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../week3/w3_exercises.html">
 <span class="dropdown-text">Week 3: Git and GitHub</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../week4/w4_exercises.html">
 <span class="dropdown-text">Week 4: Shell scripts and CLI tools</span></a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li class="dropdown-header">Assignments</li>
        <li>
    <a class="dropdown-item" href="../week0/osc-setup.html">
 <span class="dropdown-text">Pre-course: OSC account setup</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../week2/w2_github-account.html">
 <span class="dropdown-text">Week 2: GitHub account</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-final-project" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Final project</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-final-project">    
        <li>
    <a class="dropdown-item" href="../finalproj/info.html">
 <span class="dropdown-text">General info</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../finalproj/proposal.html">
 <span class="dropdown-text">I: Proposal (Due Apr 8)</span></a>
  </li>  
        <li class="dropdown-header">III: Oral presentation (TBA) (Apr 18)</li>
        <li class="dropdown-header">IV: Final submission (TBA) (Due Apr 29)</li>
    </ul>
  </li>
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-reference-pages" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Reference pages</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-reference-pages">    
        <li>
    <a class="dropdown-item" href="../ref/glossary.html">
 <span class="dropdown-text">Glossary</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../ref/shell.html">
 <span class="dropdown-text">Unix shell</span></a>
  </li>  
        <li class="dropdown-header">Markdown (TBA)</li>
        <li class="dropdown-header">Git (TBA)</li>
        <li class="dropdown-header">Shell scripting (TBA)</li>
        <li class="dropdown-header">OSC, Slurm, and Conda (TBA)</li>
        <li class="dropdown-header">Nextflow (TBA)</li>
        <li class="dropdown-header">List of Further Resources (TBA)</li>
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://osu.instructure.com/courses/163340"> 
<span class="menu-text"><i class="fa-solid fa-graduation-cap" aria-label="graduation-cap"></i></span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://ondemand.osc.edu"> 
<span class="menu-text"><i class="fa-solid fa-desktop" aria-label="desktop"></i></span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://library.ohio-state.edu/record=b8624007~S7"> 
<span class="menu-text"><i class="fa-solid fa-book" aria-label="book"></i></span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://library.ohio-state.edu/record=b9490023~S7"> 
<span class="menu-text"><i class="fa-solid fa-book-open" aria-label="book-open"></i></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
    <div class="dropdown">
      <a href="" title="" id="quarto-navigation-tool-dropdown-0" class="quarto-navigation-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false" aria-label=""><i class="bi bi-github"></i></a>
      <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="quarto-navigation-tool-dropdown-0">
          <li>
            <a class="dropdown-item quarto-navbar-tools-item" href="https://github.com/jelmerp/pracs-sp24">
            Source Code
            </a>
          </li>
          <li>
            <a class="dropdown-item quarto-navbar-tools-item" href="https://github.com/jelmerp/pracs-sp24/issues/new">
            Report an Issue
            </a>
          </li>
      </ul>
    </div>
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#main-exercises" id="toc-main-exercises" class="nav-link active" data-scroll-target="#main-exercises"><span class="header-section-number">1</span> Main exercises</a>
  <ul class="collapse">
  <li><a href="#background" id="toc-background" class="nav-link" data-scroll-target="#background"><span class="header-section-number">1.1</span> Background</a></li>
  <li><a href="#exercise-1-setting-up" id="toc-exercise-1-setting-up" class="nav-link" data-scroll-target="#exercise-1-setting-up"><span class="header-section-number">1.2</span> Exercise 1: Setting up</a></li>
  <li><a href="#exercise-2-create-a-script-to-compute-stats-for-a-fastq-file" id="toc-exercise-2-create-a-script-to-compute-stats-for-a-fastq-file" class="nav-link" data-scroll-target="#exercise-2-create-a-script-to-compute-stats-for-a-fastq-file"><span class="header-section-number">1.3</span> Exercise 2: Create a script to compute stats for a FASTQ file</a></li>
  <li><a href="#exercise-3-modify-the-looping-script" id="toc-exercise-3-modify-the-looping-script" class="nav-link" data-scroll-target="#exercise-3-modify-the-looping-script"><span class="header-section-number">1.4</span> Exercise 3: Modify the looping script</a></li>
  <li><a href="#exercise-4-bells-and-whistles" id="toc-exercise-4-bells-and-whistles" class="nav-link" data-scroll-target="#exercise-4-bells-and-whistles"><span class="header-section-number">1.5</span> Exercise 4: Bells and whistles</a></li>
  </ul></li>
  <li><a href="#bonus-exercises" id="toc-bonus-exercises" class="nav-link" data-scroll-target="#bonus-exercises"><span class="header-section-number">2</span> Bonus exercises</a>
  <ul class="collapse">
  <li><a href="#exercise-5-find-the-longest-file2" id="toc-exercise-5-find-the-longest-file2" class="nav-link" data-scroll-target="#exercise-5-find-the-longest-file2"><span class="header-section-number">2.1</span> Exercise 5: Find the longest file</a></li>
  <li><a href="#exercise-6-plant-pollinator-networks" id="toc-exercise-6-plant-pollinator-networks" class="nav-link" data-scroll-target="#exercise-6-plant-pollinator-networks"><span class="header-section-number">2.2</span> Exercise 6: Plant-pollinator networks</a></li>
  <li><a href="#exercise-7-data-explorer" id="toc-exercise-7-data-explorer" class="nav-link" data-scroll-target="#exercise-7-data-explorer"><span class="header-section-number">2.3</span> Exercise 7: Data explorer</a></li>
  </ul></li>
  <li><a href="#solutions" id="toc-solutions" class="nav-link" data-scroll-target="#solutions"><span class="header-section-number">3</span> Solutions</a>
  <ul class="collapse">
  <li><a href="#exercise-1" id="toc-exercise-1" class="nav-link" data-scroll-target="#exercise-1"><span class="header-section-number">3.1</span> Exercise 1</a></li>
  <li><a href="#exercise-2" id="toc-exercise-2" class="nav-link" data-scroll-target="#exercise-2"><span class="header-section-number">3.2</span> Exercise 2</a></li>
  <li><a href="#exercise-3" id="toc-exercise-3" class="nav-link" data-scroll-target="#exercise-3"><span class="header-section-number">3.3</span> Exercise 3</a></li>
  <li><a href="#exercise-4" id="toc-exercise-4" class="nav-link" data-scroll-target="#exercise-4"><span class="header-section-number">3.4</span> Exercise 4</a></li>
  <li><a href="#exercise-5" id="toc-exercise-5" class="nav-link" data-scroll-target="#exercise-5"><span class="header-section-number">3.5</span> Exercise 5</a></li>
  <li><a href="#exercise-6" id="toc-exercise-6" class="nav-link" data-scroll-target="#exercise-6"><span class="header-section-number">3.6</span> Exercise 6</a></li>
  <li><a href="#exercise-7" id="toc-exercise-7" class="nav-link" data-scroll-target="#exercise-7"><span class="header-section-number">3.7</span> Exercise 7</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Week 4 exercises</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<hr>
<p><br></p>
<section id="main-exercises" class="level2" data-number="1">
<h2 data-number="1" class="anchored" data-anchor-id="main-exercises"><span class="header-section-number">1</span> Main exercises</h2>
<section id="background" class="level3" data-number="1.1">
<h3 data-number="1.1" class="anchored" data-anchor-id="background"><span class="header-section-number">1.1</span> Background</h3>
<p>These exercises will work with 6 <a href="https://support.illumina.com/bulletins/2016/04/fastq-files-explained.html">FASTQ files</a> with sequences from the V4 region of 16S rRNA, generated in a metabarcoding experiment.</p>
<p>The FASTQ files come in pairs — for every sample, there is:</p>
<ul>
<li>A FASTQ file with <em>forward reads</em> (or “read 1” reads) that contains <code>_R1_</code> in its filename,</li>
<li>A FASTQ file with corresponding <em>reverse</em> reads (or “read 2” reads) that contains <code>_R2_</code> in its filename.</li>
</ul>
<p>So, our 6 FASTQ files consist of 3 pairs of files with forward and reverse reads for 3 samples.</p>
<p>The sequences were generated by first amplifying environmental samples with a pair of universal 16S primers, and these primer sequences are expected to be present in the FASTQ sequences. You will search for these primer sequences below, and there are two things to be aware of:</p>
<ul>
<li>A primer can also be present in the FASTQ sequence as its <em>reverse complement</em>, so we will search for reverse complements too.</li>
<li>The primers contain a few variable sites, which are indicated using <em>ambiguity codes</em>. For instance, an <code>R</code> means that the site can be either an <code>A</code> or a <code>G</code>, and an <code>N</code> means that the site can be any of the four bases. See <a href="https://droog.gs.washington.edu/parc/images/iupac.html">here</a> for a complete overview of these ambiguity codes.</li>
</ul>
<p>Here are the primer sequences and their reverse complements:</p>
<ul>
<li>Forward primer (“515F”): <code>GAGTGYCAGCMGCCGCGGTAA</code> / <code>TTACCGCGGCKGCTGRCACTC</code>.</li>
<li>Reverse primer (“806R”): <code>ACGGACTACNVGGGTWTCTAAT</code> / <code>ATTAGAWACCCBNGTAGTCCGT</code>.</li>
</ul>
<hr style="height:1pt; visibility:hidden;">
</section>
<section id="exercise-1-setting-up" class="level3" data-number="1.2">
<h3 data-number="1.2" class="anchored" data-anchor-id="exercise-1-setting-up"><span class="header-section-number">1.2</span> Exercise 1: Setting up</h3>
<ol type="1">
<li><p>Create a directory for this week’s exercises and move into it.</p></li>
<li><p>In these exercises, you will be working with and modifying one of the scripts in Buffalo’s Chapter 12, which is printed below. Save this script as <code>fastq_stat_loop.sh</code>.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co">#!/bin/bash</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="bu">set</span> <span class="at">-euo</span> pipefail </span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Specify the input samples file (3rd column = path to FASTQ file):</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="va">sample_info</span><span class="op">=</span>samples.txt </span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a Bash array from the third column of "$sample_info":</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="va">sample_files</span><span class="op">=</span><span class="va">($(</span><span class="fu">cut</span> <span class="at">-f</span> 3 <span class="st">"</span><span class="va">$sample_info</span><span class="st">"</span><span class="va">))</span> </span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Loop through the array:</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> fastq_file <span class="kw">in</span> <span class="st">"</span><span class="va">${sample_files</span><span class="op">[@]</span><span class="va">}</span><span class="st">"</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Strip .fastq from each FASTQ file, and add a suffix:</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>    <span class="va">results_file</span><span class="op">=</span><span class="st">"</span><span class="va">$(</span><span class="fu">basename</span> <span class="va">$fastq_file</span> .fastq<span class="va">)</span><span class="st">-stats.txt"</span> </span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Run "fastq_stat" on a file:</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>    <span class="ex">fastq_stat</span> <span class="st">"</span><span class="va">$fastq_file</span><span class="st">"</span> <span class="op">&gt;</span> stats/<span class="va">$results_file</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p>The FASTQ files you’ll work with are inside the directory <code>/fs/ess/PAS2700/data/week05/fastq</code>. Copy these files into an appropriate directory inside your own directory for these exercises, like <code>data/</code>.</p></li>
</ol>
<p><br></p>
</section>
<section id="exercise-2-create-a-script-to-compute-stats-for-a-fastq-file" class="level3" data-number="1.3">
<h3 data-number="1.3" class="anchored" data-anchor-id="exercise-2-create-a-script-to-compute-stats-for-a-fastq-file"><span class="header-section-number">1.3</span> Exercise 2: Create a script to compute stats for a FASTQ file</h3>
<p>Unfortunately, the <code>fastq_stat</code> program referenced in Buffalo’s script is an imaginary program. So, let’s create a script <code>fastqc_stat.sh</code> that actually produces a few descriptive statistics for a a FASTQC file.</p>
<ol type="1">
<li><p>Set up a script skeleton with the header lines we’ve been discussing: a <em>shebang</em> line and the various <code>set</code> settings for robust scripts.</p></li>
<li><p>The script should process one command-line argument, the input file. Assign the automatic placeholder variable for the first argument to a variable with a descriptive name, like <code>fastq_file</code>.</p></li>
</ol>
<details>
<summary>
Hints
</summary>
The automatic placeholder variable for the first argument is <code>$1</code>.
</details>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>In the sections below, you can print all your output to standard out, i.e.&nbsp;simply use <code>echo</code> with no redirection. Also, just for the purpose of testing the commands while developing them below, it will be convenient to assign one of the FASTQ files to a variable <code>fastq_file</code>.</p>
</div>
</div>
<ol start="3" type="1">
<li><p>Have the script report the name of the FASTQ file that is being processed.</p></li>
<li><p>Compute and report the number of reads in the FASTQ file.</p></li>
</ol>
<details>
<summary>
Hints
</summary>
<p>The number of reads can be assumed to be the total number of lines divided by 4 (or alternatively, the number of lines consisting only of a <code>+</code>). Recall that FASTQ files have 4 lines per sequence: a header, the sequence, a <code>+</code> divider, and the quality scores.</p>
To make the division, you can use syntax like <code>expr 12 / 4</code> — and you can use command substitution, <code>$(wc -l ...)</code>, to insert the number of lines in the division.
</details>
<ol start="5" type="1">
<li><p>As mentioned in the Background section, the primer sequences should be present in the FASTQ files. Prior to sequence analyses, these are usually removed with a specialized program like <code>cutadapt</code>, but we can use our <code>grep</code> skills to quickly search for them.</p>
<p>We will search for the <em>forward primers only in the forwards reads</em>, and for the <em>reverse primers only in the reverse reads</em>. Therefore, start with an <code>if</code> statement that tests whether the file name contains forward (<code>_R1_</code>) or reverse (<code>_R2_</code>) reads.</p>
<p><em>If it contains forward reads</em>, you should be counting occurrences of the forward primer <strong><em>or</em></strong> its reverse complement.</p>
<p>Similarly, <em>if it contains reverse reads</em> you should be counting occurrences of the reverse primer <em>or</em> its reverse complement. You’ll also have to replace the ambiguity codes, like <code>R</code>, with <em>character classes</em> that enumerate the possible alternative bases.</p></li>
</ol>
<details>
<summary>
Hints
</summary>
<p>The test in the <code>if</code> statement should be a <code>grep</code> command that examines whether the filename contains <code>_R1_</code> (pipe <code>echo</code> output into <code>grep</code>). The <code>grep</code> standard output should be redirected to <code>/dev/null</code>, since we’re only interested in the <em>exit status</em>: if <code>grep</code> finds a match, the commands following <code>then</code> will be executed; if it doesn’t, the commands following <code>else</code> will be executed.</p>
<p>You can assume that matches will only be made in the sequences themselves (and not the headers or quality scores), so you can <code>grep</code> the file as is: you don’t need to first select the lines with sequences.</p>
<p>To replace ambiguity codes with character classes in the <code>grep</code> regular expression: an <code>R</code> in the primers becomes <code>[AG]</code> in the <code>grep</code> expression, e.g.&nbsp;the partial sequence <code>ATRG</code> would become <code>AT[AG]G</code> in your regular expression.</p>
You’ll need both the primer <em>and</em> its reverse complement in a single <code>grep</code> regular expression: separate them with an logical “or” (<code>|</code>) and to enable this, use <code>grep -E</code> for extended regular expressions.
</details>
<ol start="6" type="1">
<li>Bonus: Print a count table of sequence lengths.</li>
</ol>
<details>
<summary>
Hints
</summary>
<p>You’ll have to select only the lines with the actual DNA sequences, and the best way of doing that is using <code>awk</code> like so (see the Solution for an explanation of why this works):</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="st">'{ if(NR%4 == 2) }'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Next, you need to count the number of characters in each line, which is best done in the same <code>awk</code> command using <code>print length($0)</code>, which will print the number of characters in the line.</p>
<p>After that, it’s the familiar <code>sort | uniq -c</code> idiom to create a count table.</p>
</details>
<ol start="8" type="1">
<li>Run the script for a single FASTQ file by calling it from the command line.</li>
</ol>
<p><br></p>
</section>
<section id="exercise-3-modify-the-looping-script" class="level3" data-number="1.4">
<h3 data-number="1.4" class="anchored" data-anchor-id="exercise-3-modify-the-looping-script"><span class="header-section-number">1.4</span> Exercise 3: Modify the looping script</h3>
<p>Now, let’s modify Buffalo’s script <code>fastq_stat_loop.sh</code>.</p>
<ol type="1">
<li><p>Currently, the metadata file that contains the list of files to process is hard-coded as <code>samples.txt</code>. Also, the file names have to be extracted from a specific column from the metadata file. This is not a very flexible setup, and is sensitive to minor changes in a file like <code>samples.txt</code>.</p>
<p>Change the script to <em>let it accept a list of FASTQ file names as an argument</em>.</p></li>
</ol>
<details>
<summary>
Hints
</summary>
Inside the command substitution (<code>$()</code>) that populates the array, you can simply use <code>cat</code> instead of <code>cut</code> on the file that contains the list of file names, since this file will no longer have multiple columns.
</details>
<ol start="2" type="1">
<li>Currently, the output directory is also hard-coded, as <code>stats</code> — let’s instead <em>add the output directory as a second argument to the script</em>. Moreover, add code that creates this output directory if it doesn’t already exist.</li>
</ol>
<details>
<summary>
Hints
</summary>
You can write an explicit test to see if the output dir exists first, but simply using <code>mkdir -p</code> will also work: with the <code>-p</code> option, <code>mkdir</code> doesn’t complain when a dir already exists (and can also make multiple levels of directories at once).
</details>
<ol start="3" type="1">
<li><p>Change the line that runs the imaginary program <code>fastq_stat</code> to let it run your <code>fastq_stat.sh</code> script instead. Make sure the path to your script and the path to the output file is correct.</p></li>
<li><p>In each iteration of the loop, let the script report which FASTQ file will be analyzed.</p></li>
<li><p>Now that the script takes arguments, we need <em>another file or script</em> to create the list of filenames and to submit the script with the appropriate arguments. Specifically, in this file, we need:</p>
<ul>
<li>A line that creates a new file just containing the FASTQ file names (akin to column 3 from <code>samples.txt</code> – but with the paths to our actual FASTQ files).</li>
<li>A line that runs the <code>fastq_stat_loop.sh</code> script. The file that contains the list of FASTQ files should be passed to the script as the <em>first argument</em>, and the output directory as the <em>second argument</em>. As for the actual path to the output dir, you can use whatever (relative!) path makes sense to you.</li>
</ul>
<p><strong>Create the file containing the code outlined above.</strong> You can save this file either as a <code>.sh</code> script (e.g.&nbsp;<code>fastqc_runner.sh</code>), or put these lines in a Markdown file inside a code block. Either option is reasonable because these lines would likely be run <em>interactively</em>, as opposed to the <code>fastq_stat_loop.sh</code> script which will be run non-interactively. It’s still important to save these interactive commands in a file, so you know what you did and can easily reproduce it.</p></li>
<li><p>Run the <code>fastq_stat_loop.sh</code> script.</p>
<p>The loop script should run <code>fastq_stat.sh</code> on all your FASTQ files. Check the output, which should be in one file per FASTQ file in the output dir you designated. You should be seeing that the vast majority of reads contain the primer sequences. Be proud – with a quick script that only runs for a couple of seconds, and no specialized software, you have queried hundreds of thousands of sequences!</p></li>
</ol>
<p><br></p>
</section>
<section id="exercise-4-bells-and-whistles" class="level3" data-number="1.5">
<h3 data-number="1.5" class="anchored" data-anchor-id="exercise-4-bells-and-whistles"><span class="header-section-number">1.5</span> Exercise 4: Bells and whistles</h3>
<p>In this exercise, you will touch up your <code>fastqc_stat.sh</code> script to include tests for robustness, and to report what the script is doing.</p>
<p>For the tests, check whether they work (…)! For instance, to check the test for the number of arguments, try running the script with no arguments, and also with two arguments, and see if the script produces the error messages you wrote.</p>
<ol type="1">
<li>Write an <code>if</code> statement to check whether the FASTQ file exists / is a regular file and whether it can be read. If not, give an error and exit the script with exit code 1.</li>
</ol>
<details>
<summary>
Hints
</summary>
<p>Go back to this week’s pages for an example of testing whether a file is a regular file (<code>-f</code>) and whether it can be read (<code>-r</code>).</p>
To exit with exit code 1, simply use: <code>exit 1</code>. This should be done <em>after</em> printing any error messages you, or those won’t actually be printed.
</details>
<ol start="2" type="1">
<li>Test whether exactly 1 argument was passed to the script on the command line. If not, return an error, succinctly report how to use the script (“usage: …”), and exit with exit code 1.</li>
</ol>
<details>
<summary>
Hints
</summary>
<p>Go back to this week’s pages for an example of a very similar test.</p>
<p>The number of arguments that were passed to a script are automatically available in <code>$#</code>.</p>
<p>You can test for equality using <code>&lt;integer&gt; -eq &lt;integer&gt;</code> (e.g.&nbsp;<code>10 -eq 10</code> which will evaluate to <code>true</code>) and you can <em>negate</em> a test (“number of argument is <em>not</em> equal to 1) using a <code>!</code> before the comparison expression.</p>
</details>
<ol start="3" type="1">
<li>Add <code>date</code> commands at the start and the end of the script, so you’ll be able to tell how long it took the script to complete.</li>
</ol>
<p><br></p>
</section>
</section>
<section id="bonus-exercises" class="level2" data-number="2">
<h2 data-number="2" class="anchored" data-anchor-id="bonus-exercises"><span class="header-section-number">2</span> Bonus exercises</h2>
<section id="exercise-5-find-the-longest-file2" class="level3" data-number="2.1">
<h3 data-number="2.1" class="anchored" data-anchor-id="exercise-5-find-the-longest-file2"><span class="header-section-number">2.1</span> Exercise 5: Find the longest file<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a></h3>
<p>Write a shell script called <code>longest.sh</code> that takes two arguments: the name of a directory and a file extension (like <code>txt</code>). The script should print the name of the file that has the most lines among all files with with that extension in that directory.</p>
<p>Make sure the script has the <em>shebang</em> and <code>set</code> headers, and make the script executable.</p>
<p>Then, run your script to learn which FASTQ file has the most lines (and sequences):</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">bash</span> longest.sh data/fastq fastq</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>… should print the name of the <code>.fastq</code> file in <code>data/fastq</code> with the highest number of lines and therefore sequences.</p>
<details>
<summary>
Hints
</summary>
You can count lines for many files at once using <code>wc -l</code>: simply provide it with a globbing pattern.
</details>
</section>
<section id="exercise-6-plant-pollinator-networks" class="level3" data-number="2.2">
<h3 data-number="2.2" class="anchored" data-anchor-id="exercise-6-plant-pollinator-networks"><span class="header-section-number">2.2</span> Exercise 6: Plant-pollinator networks</h3>
<p><em>This exercise is slightly modified after 1.10.3 from the CSB book.</em> <em>The <code>Saavedra2013</code> </em>directory can be found inside the CSB repository at <code>CSB/unix/data/Saavedra2013</code>,<em> </em>and the following code assumes you are in the directory <code>CSB/unix/sandbox</code>.<em> </em>(If you no longer have the repository, download it again using <code>git clone https://github.com/CSB-book/CSB.git</code>.)*</p>
<p>Saavedra and Stouffer (2013) studied several plant–pollinator networks. These can be represented as rectangular matrices where the rows are pollinators, the columns plants, a 0 indicates the absence and 1 the presence of an interaction between the plant and the pollinator.</p>
<p>The data of Saavedra and Stouffer (2013) can be found in the directory <code>CSB/unix/data/Saavedra2013</code>.</p>
<ol type="1">
<li><p>Write a script that takes one of these files as an argument, and determines the number of rows (pollinators) and columns (plants). Note that columns are separated by spaces. Don’t forget to make your script executable and to add the standard header lines. Your script should return:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">bash</span> ./netsize.sh ../data/Saavedra2013/n1.txt</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre class="bash-out"><code>Filename: ../data/Saavedra2013/n1.txt
Number of rows: 97
Number of columns: 80</code></pre></li>
<li><p>Write a script that prints the numbers of rows and columns for each network, taking the directory containing all the files as an argument:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="ex">./netsize_all.sh</span> ../data/Saavedra2013</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre class="bash-out"><code>../data/Saavedra2013/n10.txt     14      20
../data/Saavedra2013/n11.txt     270     91
../data/Saavedra2013/n12.txt     7       72
../data/Saavedra2013/n13.txt     61      17
#[...output truncated...]</code></pre></li>
</ol>
<details>
<summary>
Hints
</summary>
<p>To find the number of columns, use <code>awk</code> and recall <code>awk</code>’s <code>NF</code> (number of fields =&gt; number of columns) keyword. To combine them in a script, use command substitution to assign the result of a command to a variable. (For example: <code>mytxtfiles=$(ls *.txt)</code> stores the list of <code>.txt</code> files in the variable <code>$mytxtfiles</code>.)</p>
<p>Next, you need to write a <code>for</code> loop.</p>
<p>You can now use the script you’ve just written in combination with <code>sort</code> to answer the questions (remember the option <code>-k</code> to choose a column and <code>-r</code> to reverse the sorting order).</p>
You can use <code>echo -e</code> to print tabs using <code>\t</code>: <code>echo -e "column1 \t column2"</code>.
</details>
</section>
<section id="exercise-7-data-explorer" class="level3" data-number="2.3">
<h3 data-number="2.3" class="anchored" data-anchor-id="exercise-7-data-explorer"><span class="header-section-number">2.3</span> Exercise 7: Data explorer</h3>
<p><em>This is slightly modified after exercise 1.10.4 from the CSB book.</em> <em>The <code>Buzzard2015_data.csv</code> file can be found inside the CSB repository at <code>CSB/unix/data/Buzzard2015_data.csv</code>.</em></p>
<p>Buzzard et al.&nbsp;(2016) collected data on the growth of a forest in Costa Rica. In the file <code>Buzzard2015_data.csv</code> you will find a subset of their data, including taxonomic information, abundance, and biomass of trees.</p>
<ol type="1">
<li><p>Write a script that, for a given CSV file and column number, prints:</p>
<ul>
<li>The corresponding column name</li>
<li>The number of distinct values in the column;</li>
<li>The minimum value;</li>
<li>The maximum value.</li>
</ul></li>
</ol>
<p>Don’t forget to make your script executable and add the standard header lines.</p>
<p>For example, see the following call to the script and what it returns:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">bash</span> explore.sh ../data/Buzzard2015_data.csv 7</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre class="bash-out"><code>Column name:
biomass
Number of distinct values:
285
Minimum value:
1.048466198
Maximum value:
14897.29471</code></pre>
<details>
<summary>
Hints
</summary>
<p>You can select a given column from a <code>csv</code> file using the command <code>cut</code>. Then:</p>
<ul>
<li>The column name is going to be in the first line (<em>header</em>); access it with <code>head</code>.</li>
<li>For the next few commands, you’ll need to remove the header line — the <code>tail</code> trick to do so is <code>tail -n +2</code>.</li>
<li>The number of distinct values can be found by counting the number of lines when you have sorted them and removed duplicates (using a combination of <code>tail</code>, <code>sort</code> and <code>uniq</code>).</li>
<li>The minimum and maximum values can be found by combining <code>sort</code> and <code>head</code> (or <code>tail</code>).</li>
<li>Rename the placeholders <code>$1</code> and <code>$2</code> for the command-line arguments to named variables for the file name and column number, respectively.</li>
</ul>
</details>
<p><br></p>
</section>
</section>
<section id="solutions" class="level2" data-number="3">
<h2 data-number="3" class="anchored" data-anchor-id="solutions"><span class="header-section-number">3</span> Solutions</h2>
<section id="exercise-1" class="level3" data-number="3.1">
<h3 data-number="3.1" class="anchored" data-anchor-id="exercise-1"><span class="header-section-number">3.1</span> Exercise 1</h3>
<details>
<summary>
(1.) Create a directory for these exercises.
</summary>
<div class="sourceCode" id="cb10"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> /fs/ess/PAS1855/users/<span class="va">$USER</span>/week05/exercises/</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<details>
<summary>
(3.) Copy the FASTQ files into your own dir.
</summary>
<div class="sourceCode" id="cb11"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> <span class="at">-p</span> data/fastq/</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cp</span> /fs/ess/PAS1855/data/week05/fastq/<span class="pp">*</span> data/fastq/</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</section>
<section id="exercise-2" class="level3" data-number="3.2">
<h3 data-number="3.2" class="anchored" data-anchor-id="exercise-2"><span class="header-section-number">3.2</span> Exercise 2</h3>
<details>
<summary>
(1.) Create a new script with header lines.
</summary>
<p>The first two lines of the script:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co">#!/bin/bash</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="bu">set</span> <span class="at">-u</span> <span class="at">-e</span> <span class="at">-o</span> pipefail</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
Save the file as <code>fastq_stat.sh</code>.
</details>
<details>
<summary>
(2.) Assign the first argument to a named variable.
</summary>
<p>Add a line like this to your <code>fastq_stat.sh</code> script:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="va">fastq_file</span><span class="op">=</span><span class="va">$1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<details>
<summary>
(3.) Let the script report its name and the name of the FASTQ file.
</summary>
<p>For testing the code below, we first assign one of the FASTQ filenames to the variable <code>$fastq_file</code>:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="va">fastq_file</span><span class="op">=</span>201-S4-V4-V5_S53_L001_R1_001.fastq</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Add lines like these to your <code>fastq_stat.sh</code> script:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">"fastq_stat.sh: A script to compute basic summary stats for a FASTQ file."</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">"FASTQ file to be analyzed: </span><span class="va">$fastq_file</span><span class="st">"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<details>
<summary>
(4.) Compute and report the number of sequences in the FASTQ file.
</summary>
<p>Add lines like these to your <code>fastq_stat.sh</code> script:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># We save the output of our commands using command substitution, $().</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="co"># In the wc -l command, use input redirection so the filename is not in the output.</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="va">n_lines</span><span class="op">=</span><span class="va">$(</span><span class="fu">wc</span> <span class="at">-l</span> <span class="op">&lt;</span> <span class="st">"</span><span class="va">$fastq_file</span><span class="st">"</span><span class="va">)</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="va">n_seqs</span><span class="op">=</span><span class="va">$(</span><span class="fu">expr</span> <span class="st">"</span><span class="va">$n_lines</span><span class="st">"</span> / 4<span class="va">)</span>     <span class="co"># Use expr for arithmetic</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">"Number of sequences: </span><span class="va">$n_seqs</span><span class="st">"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li><p>Alternatively, you can use the <code>(( ))</code> syntax for arithmetic – just take care that in this case, there can be no spaces between the mathematical operator and the numbers:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co">#n_seqs=$(("$n_lines"/4))</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p>To get the number of sequences, you can also count the number of lines that only have a <code>+</code> symbol:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="va">n_seqs</span><span class="op">=</span><span class="va">$(</span><span class="fu">grep</span> <span class="at">-c</span> <span class="st">"^+$"</span> <span class="va">$fastq_file)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Recall that <code>+</code> is also a regular expression symbol, but only so in the extended regex set. Therefore, without the <code>-E</code> flag to <code>grep</code>, we are matching a literal <code>+</code> when we use one in our expression.</p></li>
</ul>
</details>
<details>
<summary>
(5.) Search for adapter sequences.
</summary>
<p>Add lines like these to your <code>fastq_stat.sh</code> script:</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="bu">echo</span> <span class="st">"</span><span class="va">$fastq_file</span><span class="st">"</span> <span class="kw">|</span> <span class="fu">grep</span> <span class="st">"_R1_"</span> <span class="op">&gt;</span>/dev/null<span class="kw">;</span> <span class="cf">then</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>    <span class="bu">echo</span> <span class="st">"FASTQ file contains forward (R1) reads, checking for primer 1..."</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>    <span class="va">n_primerF</span><span class="op">=</span><span class="va">$(</span><span class="fu">grep</span> <span class="at">-Ec</span> <span class="st">"GAGTG[CT]CAGC[AC]GCCGCGGTAA|TTACCGCGGC[GT]GCTG[AG]CACTC"</span> <span class="st">"</span><span class="va">$fastq_file</span><span class="st">"</span><span class="va">)</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>    <span class="bu">echo</span> <span class="st">"Number of forward primer sequences found: </span><span class="va">$n_primerF</span><span class="st">"</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>    <span class="bu">echo</span> <span class="st">"FASTQ file contains forward (R2) reads, checking for primer 2..."</span></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>    <span class="va">n_primerR</span><span class="op">=</span><span class="va">$(</span><span class="fu">grep</span> <span class="at">-Ec</span> <span class="st">"ACGGACTAC[ACTG][ACG]GGGT[AT]TCTAAT|ATTAGA[AT]ACCCB[ACTG]GTAGTCCGT"</span> <span class="st">"</span><span class="va">$fastq_file</span><span class="st">"</span><span class="va">)</span></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>    <span class="bu">echo</span> <span class="st">"Number of reverse primer sequences found: </span><span class="va">$n_primerR</span><span class="st">"</span></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a><span class="cf">fi</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>To initiate the <code>if</code> statement:</p>
<ul>
<li>We redirect <code>grep</code>’s output to <code>/dev/null</code>, since we’re only interested in the exit status.</li>
<li>If <code>grep</code> finds a match, this evaluates to “true”, and the next code block will be executed. If no match is found, the block after <code>else</code> will be executed.</li>
</ul>
<p>Inside the <code>if</code> statement:</p>
<ul>
<li>We use the <code>grep</code>’s <code>-E</code> option to search for either of the two primer sequences at once with <code>|</code>.</li>
<li>We use character classes like <code>[CT]</code> in place of each ambiguity code.</li>
<li>We use <code>grep</code>’s <code>-c</code> option to count the matches.</li>
</ul>
<p>Or, to explicitly check the file contains <code>_R2</code> in its name, rather than assuming this must be the case if it doesn’t contain <code>_R1</code>, you can use <code>elif</code> (short for “else-if”) to add another test:</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="bu">echo</span> <span class="st">"</span><span class="va">$fastq_file</span><span class="st">"</span> <span class="kw">|</span> <span class="fu">grep</span> <span class="st">"_R1_"</span> <span class="op">&gt;</span>/dev/null<span class="kw">;</span> <span class="cf">then</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>    <span class="bu">echo</span> <span class="st">"FASTQ file contains forward (R1) reads, checking for primer 1..."</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>    <span class="va">n_primerF</span><span class="op">=</span><span class="va">$(</span><span class="fu">grep</span> <span class="at">-Ec</span> <span class="st">"GAGTG[CT]CAGC[AC]GCCGCGGTAA|TTACCGCGGC[GT]GCTG[AG]CACTC"</span> <span class="st">"</span><span class="va">$fastq_file</span><span class="st">"</span><span class="va">)</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>    <span class="bu">echo</span> <span class="st">"Number of forward primer sequences found: </span><span class="va">$n_primerF</span><span class="st">"</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a><span class="cf">elif</span> <span class="bu">echo</span> <span class="st">"</span><span class="va">$fastq_file</span><span class="st">"</span> <span class="kw">|</span> <span class="fu">grep</span> <span class="st">"_R2_"</span> <span class="op">&gt;</span>/dev/null<span class="kw">;</span> <span class="cf">then</span></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>    <span class="bu">echo</span> <span class="st">"FASTQ file contains forward (R2) reads, checking for primer 2..."</span></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>    <span class="va">n_primerR</span><span class="op">=</span><span class="va">$(</span><span class="fu">grep</span> <span class="at">-Ec</span> <span class="st">"ACGGACTAC[ACTG][ACG]GGGT[AT]TCTAAT|ATTAGA[AT]ACCCB[ACTG]GTAGTCCGT"</span> <span class="st">"</span><span class="va">$fastq_file</span><span class="st">"</span><span class="va">)</span></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>    <span class="bu">echo</span> <span class="st">"Number of reverse primer sequences found: </span><span class="va">$n_primerR</span><span class="st">"</span></span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a><span class="cf">fi</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>When we test this code by itself, we get:</p>
<pre class="bash-out-solo"><code>FASTQ file contains forward (R1) reads, checking for primer 1...
Number of forward primer sequences found: 44687</code></pre>
<p>This looks good!</p>
</details>
<details>
<summary>
(6.) Bonus: Print a count table of sequence lengths.
</summary>
<p>Add lines like these to your <code>fastq_stat.sh</code> script:</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">"Count table of sequence lengths:"</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="st">'{ if(NR%4 == 2) print length($0) }'</span> <span class="st">"</span><span class="va">$fastq_file</span><span class="st">"</span> <span class="kw">|</span> <span class="fu">sort</span> <span class="kw">|</span> <span class="fu">uniq</span> <span class="at">-c</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li>To select only actual sequences, and not other lines, from the FASTQ file, we use the following trick. We know that in the FASTQ file, every fourth line, starting from line number 2, contains the actual sequence (i.e.: line 2, line 6, line 10, etc). To select these lines we can use the “modulo” operator to select only line numbers (<code>NR</code> in <code>awk</code>) for which, after dividing the line number by 4, we have 2 left: <code>NR%4 == 2</code>.</li>
<li>Next we print the number of characters on the entire line using <code>awk</code>’s <code>length</code> function: <code>print length($0)</code>.</li>
<li>Finally, we pass the sequence lengths on to the <code>sort | uniq -c</code> idiom, which will give us a count table.</li>
</ul>
</details>
<details>
<summary>
(8.) Run the script for a single FASTQ file by calling it from the command line.
</summary>
<div class="sourceCode" id="cb23"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Assuming you have assigned a FASTQ file to $fastq_file for testing:</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="fu">bash</span> fastq_stat.sh <span class="va">$fastq_file</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</section>
<section id="exercise-3" class="level3" data-number="3.3">
<h3 data-number="3.3" class="anchored" data-anchor-id="exercise-3"><span class="header-section-number">3.3</span> Exercise 3</h3>
<details>
<summary>
(1.) Change the script to let it accept a list of FASTQ file names as an argument.
</summary>
<p>Add this line to the script:</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="va">file_list</span><span class="op">=</span><span class="va">$1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Now, replace the following line:</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Old line:</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="co"># sample_files=($(cut -f 3 "$sample_info"))</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a><span class="co"># New line:</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a><span class="co">#sample_files=($(cat "$file_list"))</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<details>
<summary>
(2.) Add the output directory as a second argument to the script, and create the output dir if necessary.
</summary>
<div class="sourceCode" id="cb26"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="va">output_dir</span><span class="op">=</span><span class="va">$2</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the output dir, if necessary:</span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> <span class="at">-p</span> <span class="st">"</span><span class="va">$output_dir</span><span class="st">"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
(<code>mkdir -p</code> will not complain if the directory already exists, and it can make multiple levels of directories at once.)
</details>
<details>
<summary>
(3.) Modify the line in the script that calls <code>fastq_stat</code> to call your script.
</summary>
<div class="sourceCode" id="cb27"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Old line:</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="co"># fastq_stat "$fastq_file" &gt; stats/$results_file</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="co"># New line:</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a><span class="ex">scripts/fastq_stat.sh</span> <span class="st">"</span><span class="va">$fastq_file</span><span class="st">"</span> <span class="op">&gt;</span> <span class="st">"</span><span class="va">$output_dir</span><span class="st">"</span>/<span class="st">"</span><span class="va">$results_file</span><span class="st">"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The <code>results_file</code> line can remain the same:</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="va">results_file</span><span class="op">=</span><span class="st">"</span><span class="va">$(</span><span class="fu">basename</span> <span class="va">$fastq_file</span> .fastq<span class="va">)</span><span class="st">-stats.txt"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<details>
<summary>
(4.) In each iteration of the loop, let the script report which FASTQ will be analyzed.
</summary>
<p>Add the following line <em>inside the loop</em>:</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">"Running fastq_stat for FASTQ file </span><span class="va">$fastq_file</span><span class="st">"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<details>
<summary>
(5.) Create a second file/script to create a list of FASTQ files and to run the loop script.
</summary>
<ul>
<li>To create a list of FASTQ files:</li>
</ul>
<div class="sourceCode" id="cb30"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="va">file_list</span><span class="op">=</span>fastq_file_list.txt</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ls</span> data/<span class="pp">*</span>fastq <span class="op">&gt;</span> <span class="st">"</span><span class="va">$file_list</span><span class="st">"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li>To run the loop script:</li>
</ul>
<div class="sourceCode" id="cb31"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="va">output_dir</span><span class="op">=</span>results/fastq_stats</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a><span class="fu">bash</span> fastq_stat_loop.sh <span class="st">"</span><span class="va">$file_list</span><span class="st">"</span> <span class="st">"</span><span class="va">$output_dir</span><span class="st">"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<details>
<summary>
<strong>The final <code>fastq_stat_loop.sh</code> script.</strong>
</summary>
<div class="sourceCode" id="cb32"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co">#!/bin/bash</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="bu">set</span> <span class="at">-e</span> <span class="at">-u</span> <span class="at">-o</span> pipefail</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a><span class="va">file_list</span><span class="op">=</span><span class="st">"</span><span class="va">$1</span><span class="st">"</span></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a><span class="va">output_dir</span><span class="op">=</span><span class="st">"</span><span class="va">$2</span><span class="st">"</span></span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the output dir, if necessary:</span></span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> <span class="at">-p</span> <span class="st">"</span><span class="va">$output_dir</span><span class="st">"</span></span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Create an array with FASTQ files</span></span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a><span class="va">fastq_files</span><span class="op">=</span><span class="va">($(</span><span class="fu">cat</span> <span class="st">"</span><span class="va">$file_list</span><span class="st">"</span><span class="va">))</span></span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Report:</span></span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">"Number of fastq files: </span><span class="va">${</span><span class="op">#</span><span class="va">fastq_files</span><span class="op">[@]</span><span class="va">}</span><span class="st">"</span></span>
<span id="cb32-15"><a href="#cb32-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-16"><a href="#cb32-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Loop through the array:</span></span>
<span id="cb32-17"><a href="#cb32-17" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> fastq_file <span class="kw">in</span> <span class="st">"</span><span class="va">${fastq_files</span><span class="op">[@]</span><span class="va">}</span><span class="st">"</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb32-18"><a href="#cb32-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-19"><a href="#cb32-19" aria-hidden="true" tabindex="-1"></a>  <span class="bu">echo</span> <span class="st">"Running fastq_stat for FASTQ file </span><span class="va">$fastq_file</span><span class="st">"</span></span>
<span id="cb32-20"><a href="#cb32-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-21"><a href="#cb32-21" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Strip .fastq from each FASTQ file, and add suffix:</span></span>
<span id="cb32-22"><a href="#cb32-22" aria-hidden="true" tabindex="-1"></a>  <span class="va">results_file</span><span class="op">=</span><span class="st">"</span><span class="va">$(</span><span class="fu">basename</span> <span class="st">"</span><span class="va">$fastq_file</span><span class="st">"</span> .fastq<span class="va">)</span><span class="st">-stats.txt"</span></span>
<span id="cb32-23"><a href="#cb32-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-24"><a href="#cb32-24" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Run "fastq_stat" on a file:</span></span>
<span id="cb32-25"><a href="#cb32-25" aria-hidden="true" tabindex="-1"></a>  <span class="ex">scripts/fastq_stat.sh</span> <span class="st">"</span><span class="va">$fastq_file</span><span class="st">"</span> <span class="op">&gt;</span><span class="st">"</span><span class="va">$output_dir</span><span class="st">"</span>/<span class="st">"</span><span class="va">$results_file</span><span class="st">"</span></span>
<span id="cb32-26"><a href="#cb32-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-27"><a href="#cb32-27" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<details>
<summary>
<strong>The final lines in the runner script / Markdown code block.</strong>
</summary>
<div class="sourceCode" id="cb33"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="va">file_list</span><span class="op">=</span>fastq_file_list.txt</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="va">output_dir</span><span class="op">=</span>results/fastq_stats</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ls</span> data/<span class="pp">*</span>fastq <span class="op">&gt;</span><span class="st">"</span><span class="va">$file_list</span><span class="st">"</span></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a><span class="fu">bash</span> fastq_stat_loop.sh <span class="st">"</span><span class="va">$file_list</span><span class="st">"</span> <span class="st">"</span><span class="va">$output_dir</span><span class="st">"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</section>
<section id="exercise-4" class="level3" data-number="3.4">
<h3 data-number="3.4" class="anchored" data-anchor-id="exercise-4"><span class="header-section-number">3.4</span> Exercise 4</h3>
<details>
<summary>
(1.) Check whether the FASTQ file is a regular file than can be read.
</summary>
<ul>
<li>Add these lines to your script:
<ul>
<li><code>! -f</code> will be true if the file is not a regular/existing file</li>
<li><code>! -r</code> will be true if the file is not readable</li>
<li>We use <code>||</code> to separate the two conditions with a logical or.</li>
<li>With <code>exit 1</code>, we terminate the script with an exit code that indicates failure.</li>
</ul></li>
</ul>
<div class="sourceCode" id="cb34"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="bu">[</span> <span class="ot">!</span> <span class="ot">-f</span> <span class="st">"</span><span class="va">$fastq_file</span><span class="st">"</span> <span class="bu">]</span> <span class="kw">||</span> <span class="bu">[</span> <span class="ot">!</span> <span class="ot">-r</span> <span class="st">"</span><span class="va">$fastq_file</span><span class="st">"</span> <span class="bu">]</span><span class="kw">;</span> <span class="cf">then</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>    <span class="bu">echo</span> <span class="st">"Error: can't open file"</span></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>    <span class="bu">echo</span> <span class="st">"Second argument should be a readable file"</span></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>    <span class="bu">echo</span> <span class="st">"You provided: </span><span class="va">$fastq_file</span><span class="st">"</span></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>    <span class="bu">exit</span> 1</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a><span class="cf">fi</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li>To “test your test”:</li>
</ul>
<div class="sourceCode" id="cb35"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">bash</span> fastq_stat.sh blabla </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<details>
<summary>
(2.) Check whether only one argument was provided.
</summary>
<ul>
<li>Add these lines to your script:
<ul>
<li><code>$#</code> is the number of command-line arguments passed to the script</li>
<li><code>-eq</code> will test whether the numbers to the left and right of it are the same, and will return <code>true</code> if they are.</li>
<li>We negate this with <code>!</code>: if the number of arguments is NOT 1, then error out.</li>
<li><code>exit 1</code> will exit with exit code 1, which signifies an error / failure.</li>
</ul></li>
</ul>
<div class="sourceCode" id="cb36"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="bu">[</span> <span class="ot">!</span> <span class="st">"</span><span class="va">$#</span><span class="st">"</span> <span class="ot">-eq</span> 1 <span class="bu">]</span><span class="kw">;</span> <span class="cf">then</span>   <span class="co"># If the number of args does NOT equal 1, then</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>    <span class="bu">echo</span> <span class="st">"Error: wrong number of arguments"</span></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>    <span class="bu">echo</span> <span class="st">"You provided </span><span class="va">$#</span><span class="st"> arguments, while 1 is required."</span></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>    <span class="bu">echo</span> <span class="st">"Usage: fastq_stat.sh &lt;file-name&gt;"</span></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>    <span class="bu">exit</span> 1</span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a><span class="cf">fi</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li>To test your test:</li>
</ul>
<div class="sourceCode" id="cb37"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> ./fastq_stat.sh                      <span class="co"># No args</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> ./fastq_stat.sh <span class="va">$fastq_file</span> blabla   <span class="co"># Two args</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<details>
<summary>
(3.) Add <code>date</code> commands.
</summary>
<p>Simply include two lines with:</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">date</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
… in the script, one before file processing, and one after.
</details>
<details>
<summary>
<strong>The final <code>fastq_stat.sh</code> script.</strong>
</summary>
<div class="sourceCode" id="cb39"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co">#!/bin/bash</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="bu">set</span> <span class="at">-u</span> <span class="at">-e</span> <span class="at">-o</span> pipefail</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">"</span><span class="va">$0</span><span class="st">: A script to compute basic summary stats for a FASTQ file."</span></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a><span class="fu">date</span></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span></span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Test number of args -------------------------------------------------</span></span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="bu">[</span> <span class="ot">!</span> <span class="st">"</span><span class="va">$#</span><span class="st">"</span> <span class="ot">-eq</span> 1 <span class="bu">]</span><span class="kw">;</span> <span class="cf">then</span></span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a>  <span class="bu">echo</span> <span class="st">"Error: wrong number of arguments"</span></span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a>  <span class="bu">echo</span> <span class="st">"You provided </span><span class="va">$#</span><span class="st"> arguments, while 1 is required."</span></span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a>  <span class="bu">echo</span> <span class="st">"Usage: fastq_stat.sh &lt;file-name&gt;"</span></span>
<span id="cb39-13"><a href="#cb39-13" aria-hidden="true" tabindex="-1"></a>  <span class="bu">exit</span> 1</span>
<span id="cb39-14"><a href="#cb39-14" aria-hidden="true" tabindex="-1"></a><span class="cf">fi</span></span>
<span id="cb39-15"><a href="#cb39-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-16"><a href="#cb39-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Process command-line args and report ------------------------------------</span></span>
<span id="cb39-17"><a href="#cb39-17" aria-hidden="true" tabindex="-1"></a><span class="va">fastq_file</span><span class="op">=</span><span class="st">"</span><span class="va">$1</span><span class="st">"</span></span>
<span id="cb39-18"><a href="#cb39-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-19"><a href="#cb39-19" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">"FASTQ file to be analyzed: </span><span class="va">$fastq_file</span><span class="st">"</span></span>
<span id="cb39-20"><a href="#cb39-20" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span></span>
<span id="cb39-21"><a href="#cb39-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-22"><a href="#cb39-22" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="bu">[</span> <span class="ot">!</span> <span class="ot">-f</span> <span class="st">"</span><span class="va">$fastq_file</span><span class="st">"</span> <span class="bu">]</span> <span class="kw">||</span> <span class="bu">[</span> <span class="ot">!</span> <span class="ot">-r</span> <span class="st">"</span><span class="va">$fastq_file</span><span class="st">"</span> <span class="bu">]</span><span class="kw">;</span> <span class="cf">then</span></span>
<span id="cb39-23"><a href="#cb39-23" aria-hidden="true" tabindex="-1"></a>  <span class="bu">echo</span> <span class="st">"Error: can't open file"</span></span>
<span id="cb39-24"><a href="#cb39-24" aria-hidden="true" tabindex="-1"></a>  <span class="bu">echo</span> <span class="st">"Second argument should be a readable file"</span></span>
<span id="cb39-25"><a href="#cb39-25" aria-hidden="true" tabindex="-1"></a>  <span class="bu">echo</span> <span class="st">"You provided: </span><span class="va">$fastq_file</span><span class="st">"</span></span>
<span id="cb39-26"><a href="#cb39-26" aria-hidden="true" tabindex="-1"></a>  <span class="bu">exit</span> 1</span>
<span id="cb39-27"><a href="#cb39-27" aria-hidden="true" tabindex="-1"></a><span class="cf">fi</span></span>
<span id="cb39-28"><a href="#cb39-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-29"><a href="#cb39-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Count primer sequences ------------------------------------------------</span></span>
<span id="cb39-30"><a href="#cb39-30" aria-hidden="true" tabindex="-1"></a><span class="va">n_lines</span><span class="op">=</span><span class="va">$(</span><span class="fu">wc</span> <span class="at">-l</span> <span class="op">&lt;</span><span class="st">"</span><span class="va">$fastq_file</span><span class="st">"</span><span class="va">)</span></span>
<span id="cb39-31"><a href="#cb39-31" aria-hidden="true" tabindex="-1"></a><span class="va">n_seqs</span><span class="op">=</span><span class="va">$(</span><span class="fu">expr</span> <span class="st">"</span><span class="va">$n_lines</span><span class="st">"</span> / 4<span class="va">)</span></span>
<span id="cb39-32"><a href="#cb39-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-33"><a href="#cb39-33" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">"Number of sequences: </span><span class="va">$n_seqs</span><span class="st">"</span></span>
<span id="cb39-34"><a href="#cb39-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-35"><a href="#cb39-35" aria-hidden="true" tabindex="-1"></a><span class="co"># Count primer sequences ------------------------------------------------</span></span>
<span id="cb39-36"><a href="#cb39-36" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="bu">echo</span> <span class="st">"</span><span class="va">$fastq_file</span><span class="st">"</span> <span class="kw">|</span> <span class="fu">grep</span> <span class="st">"_R1_"</span> <span class="op">&gt;</span>/dev/null<span class="kw">;</span> <span class="cf">then</span></span>
<span id="cb39-37"><a href="#cb39-37" aria-hidden="true" tabindex="-1"></a>    <span class="bu">echo</span> <span class="st">"FASTQ file contains forward (R1) reads, checking for primer 1..."</span></span>
<span id="cb39-38"><a href="#cb39-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-39"><a href="#cb39-39" aria-hidden="true" tabindex="-1"></a>    <span class="va">n_primerF</span><span class="op">=</span><span class="va">$(</span><span class="fu">grep</span> <span class="at">-Ec</span> <span class="st">"GAGTG[CT]CAGC[AC]GCCGCGGTAA|TTACCGCGGC[GT]GCTG[AG]CACTC"</span> <span class="st">"</span><span class="va">$fastq_file</span><span class="st">"</span><span class="va">)</span></span>
<span id="cb39-40"><a href="#cb39-40" aria-hidden="true" tabindex="-1"></a>    <span class="bu">echo</span> <span class="st">"Number of forward primer sequences found: </span><span class="va">$n_primerF</span><span class="st">"</span></span>
<span id="cb39-41"><a href="#cb39-41" aria-hidden="true" tabindex="-1"></a><span class="cf">elif</span> <span class="bu">echo</span> <span class="st">"</span><span class="va">$fastq_file</span><span class="st">"</span> <span class="kw">|</span> <span class="fu">grep</span> <span class="st">"_R2_"</span> <span class="op">&gt;</span>/dev/null<span class="kw">;</span> <span class="cf">then</span></span>
<span id="cb39-42"><a href="#cb39-42" aria-hidden="true" tabindex="-1"></a>    <span class="bu">echo</span> <span class="st">"FASTQ file contains forward (R2) reads, checking for primer 2..."</span></span>
<span id="cb39-43"><a href="#cb39-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-44"><a href="#cb39-44" aria-hidden="true" tabindex="-1"></a>    <span class="va">n_primerR</span><span class="op">=</span><span class="va">$(</span><span class="fu">grep</span> <span class="at">-Ec</span> <span class="st">"ACGGACTAC[ACTG][ACG]GGGT[AT]TCTAAT|ATTAGA[AT]ACCCB[ACTG]GTAGTCCGT"</span> <span class="st">"</span><span class="va">$fastq_file</span><span class="st">"</span><span class="va">)</span></span>
<span id="cb39-45"><a href="#cb39-45" aria-hidden="true" tabindex="-1"></a>    <span class="bu">echo</span> <span class="st">"Number of reverse primer sequences found: </span><span class="va">$n_primerR</span><span class="st">"</span></span>
<span id="cb39-46"><a href="#cb39-46" aria-hidden="true" tabindex="-1"></a><span class="cf">fi</span></span>
<span id="cb39-47"><a href="#cb39-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-48"><a href="#cb39-48" aria-hidden="true" tabindex="-1"></a><span class="co"># Bonus: Count table of sequence lengths ---------------------------------</span></span>
<span id="cb39-49"><a href="#cb39-49" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">"Count table of sequence lengths:"</span></span>
<span id="cb39-50"><a href="#cb39-50" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="st">'{ if(NR%4 == 2) print length($0) }'</span> <span class="st">"</span><span class="va">$fastq_file</span><span class="st">"</span> <span class="kw">|</span> <span class="fu">sort</span> <span class="kw">|</span> <span class="fu">uniq</span> <span class="at">-c</span></span>
<span id="cb39-51"><a href="#cb39-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-52"><a href="#cb39-52" aria-hidden="true" tabindex="-1"></a><span class="co"># Report ----------------------------------------------------------------</span></span>
<span id="cb39-53"><a href="#cb39-53" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span></span>
<span id="cb39-54"><a href="#cb39-54" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">"Done with </span><span class="va">$0</span><span class="st"> for </span><span class="va">$fastq_file</span><span class="st">."</span></span>
<span id="cb39-55"><a href="#cb39-55" aria-hidden="true" tabindex="-1"></a><span class="fu">date</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</section>
<section id="exercise-5" class="level3" data-number="3.5">
<h3 data-number="3.5" class="anchored" data-anchor-id="exercise-5"><span class="header-section-number">3.5</span> Exercise 5</h3>
<details>
<summary>
Solution
</summary>
<p>There are several ways to do this, here’s one example:</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co">#!/bin/bash</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="bu">set</span> <span class="at">-u</span> <span class="at">-e</span> <span class="at">-o</span> pipefail</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a><span class="va">dir</span><span class="op">=</span><span class="st">"</span><span class="va">$1</span><span class="st">"</span></span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a><span class="va">extension</span><span class="op">=</span><span class="st">"</span><span class="va">$2</span><span class="st">"</span></span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a><span class="fu">wc</span> <span class="at">-l</span> <span class="st">"</span><span class="va">$dir</span><span class="st">"</span>/<span class="pp">*</span>.<span class="st">"</span><span class="va">$extension</span><span class="st">"</span> <span class="kw">|</span> <span class="fu">sort</span> <span class="at">-rn</span> <span class="kw">|</span> <span class="fu">sed</span> <span class="at">-n</span> <span class="st">'2p'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>You have to print the <em>second</em> rather than the the first line: the first line will be a <em>total</em> line number count across all files, which <code>wc</code> automatically computes.</p>
<p>Instead of using <code>sed</code>, you could also use <code>head -n 2 | tail -n 1</code> to print the second line:</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="fu">wc</span> <span class="at">-l</span> <span class="st">"</span><span class="va">$dir</span><span class="st">"</span>/<span class="pp">*</span>.<span class="st">"</span><span class="va">$extension</span><span class="st">"</span> <span class="kw">|</span> <span class="fu">sort</span> <span class="at">-rn</span> <span class="kw">|</span> <span class="fu">head</span> <span class="at">-n</span> 2 <span class="kw">|</span> <span class="fu">tail</span> <span class="at">-n</span> 1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<em>(Note also that there are two files with the same number of lines: <code>R1</code> and <code>R2</code> files for the same sample always have the same number of reads.)</em>
</details>
</section>
<section id="exercise-6" class="level3" data-number="3.6">
<h3 data-number="3.6" class="anchored" data-anchor-id="exercise-6"><span class="header-section-number">3.6</span> Exercise 6</h3>
<details>
<summary>
(1.) Write a script that takes one file and determines the number of rows and columns.
</summary>
<div class="sourceCode" id="cb42"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="co">#!/bin/bash</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a><span class="bu">set</span> <span class="at">-u</span> <span class="at">-e</span> <span class="at">-o</span> pipefail</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a><span class="va">file</span><span class="op">=</span><span class="st">"</span><span class="va">$1</span><span class="st">"</span></span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">"Filename:"</span></span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">"</span><span class="va">$file</span><span class="st">"</span></span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a><span class="co"># We can get the number of rows simply by counting the number of lines:</span></span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a><span class="co"># To avoid printing the filename we redirect the input like below</span></span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a><span class="co"># (Or we could have done: "cat ../data/Saavedra2013/n10.txt | wc -l")</span></span>
<span id="cb42-12"><a href="#cb42-12" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">"Number of rows:"</span></span>
<span id="cb42-13"><a href="#cb42-13" aria-hidden="true" tabindex="-1"></a><span class="fu">wc</span> <span class="at">-l</span> <span class="op">&lt;</span> <span class="st">"</span><span class="va">$file</span><span class="st">"</span></span>
<span id="cb42-14"><a href="#cb42-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-15"><a href="#cb42-15" aria-hidden="true" tabindex="-1"></a><span class="co"># To count the number of columns, we use awk - recall that NF is the number</span></span>
<span id="cb42-16"><a href="#cb42-16" aria-hidden="true" tabindex="-1"></a><span class="co"># of fields (columns), and to print that number only for a single line, we exit:</span></span>
<span id="cb42-17"><a href="#cb42-17" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">"Number of columns:"</span></span>
<span id="cb42-18"><a href="#cb42-18" aria-hidden="true" tabindex="-1"></a><span class="fu">awk</span> <span class="st">'{ print NF; exit }'</span> <span class="st">"</span><span class="va">$file</span><span class="st">"</span></span>
<span id="cb42-19"><a href="#cb42-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-20"><a href="#cb42-20" aria-hidden="true" tabindex="-1"></a><span class="co"># head -n 1 "$file" | awk '{ print NF }' # Also works</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
We can save this script as <code>netsize.sh</code>.
</details>
<details>
<summary>
(2.) Write a script that prints the number of rows and columns for each network.
</summary>
<div class="sourceCode" id="cb43"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="co">#!/bin/bash</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a><span class="bu">set</span> <span class="at">-u</span> <span class="at">-e</span> <span class="at">-o</span> pipefail</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a><span class="va">dir</span><span class="op">=</span><span class="st">"</span><span class="va">$1</span><span class="st">"</span></span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a><span class="co"># We can loop over the files using globbing:</span></span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> file <span class="kw">in</span> <span class="st">"</span><span class="va">$dir</span><span class="st">"</span>/<span class="pp">*</span>.txt<span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Next, we can save the number of rows and columns in variables:</span></span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a>    <span class="va">n_row</span><span class="op">=</span><span class="va">$(</span><span class="fu">wc</span> <span class="at">-l</span> <span class="op">&lt;</span> <span class="st">"</span><span class="va">$file</span><span class="st">"</span><span class="va">)</span></span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true" tabindex="-1"></a>    <span class="va">n_col</span><span class="op">=</span><span class="va">$(</span><span class="fu">awk</span> <span class="st">'{ print NF; exit }'</span> <span class="st">"</span><span class="va">$file</span><span class="st">"</span><span class="va">)</span></span>
<span id="cb43-12"><a href="#cb43-12" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb43-13"><a href="#cb43-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># And print them all on one line:</span></span>
<span id="cb43-14"><a href="#cb43-14" aria-hidden="true" tabindex="-1"></a>    <span class="bu">echo</span> <span class="at">-e</span> <span class="st">"</span><span class="va">$file</span><span class="st"> \t </span><span class="va">$n_row</span><span class="st"> \t </span><span class="va">$n_col</span><span class="st">"</span></span>
<span id="cb43-15"><a href="#cb43-15" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>We can save this script as <code>netsize_all.sh</code> and run it as follows:</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="fu">bash</span> netsize_all.sh ../data/Saavedra2013</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<details>
<summary>
(3.) Which network has the largest number of rows and which the largest number of columns?
</summary>
<p>Having written the script netsize_all.sh, you can take its output and order it according to rows or columns.</p>
<p>Sorting by column 2 gives you the file with the largest number of rows:</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="fu">bash</span> netsize_all.sh <span class="kw">|</span> <span class="fu">sort</span> <span class="at">-n</span> <span class="at">-r</span> <span class="at">-k</span> 2 <span class="kw">|</span> <span class="fu">head</span> <span class="at">-n</span> 1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre class="bash-out"><code>../data/Saavedra2013/n58.txt 678 90</code></pre>
<p>Sorting by column 3 gives you the file with the largest number of columns:</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="fu">bash</span> netsize_all.sh <span class="kw">|</span> <span class="fu">sort</span> <span class="at">-n</span> <span class="at">-r</span> <span class="at">-k</span> 3 <span class="kw">|</span> <span class="fu">head</span> <span class="at">-n</span> 1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre class="bash-out"><code>../data/Saavedra2013/n56.txt 110 207</code></pre>
</details>
</section>
<section id="exercise-7" class="level3" data-number="3.7">
<h3 data-number="3.7" class="anchored" data-anchor-id="exercise-7"><span class="header-section-number">3.7</span> Exercise 7</h3>
<details>
<summary>
Solution
</summary>
<div class="sourceCode" id="cb49"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="co">#!/bin/bash</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a><span class="bu">set</span> <span class="at">-u</span> <span class="at">-e</span> <span class="at">-o</span> pipefail</span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a><span class="va">file</span><span class="op">=</span><span class="va">$1</span>    <span class="co"># $1 is the file name</span></span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a><span class="va">column</span><span class="op">=</span><span class="va">$2</span>  <span class="co"># $2 is the column of interest</span></span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">"Column name:"</span></span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a><span class="fu">cut</span> <span class="at">-d</span> <span class="st">','</span> <span class="at">-f</span> <span class="st">"</span><span class="va">$column</span><span class="st">"</span> <span class="st">"</span><span class="va">$file</span><span class="st">"</span> <span class="kw">|</span> <span class="fu">head</span> <span class="at">-n</span> 1</span>
<span id="cb49-10"><a href="#cb49-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-11"><a href="#cb49-11" aria-hidden="true" tabindex="-1"></a><span class="co"># In the next lines, we need to skip the header, which we can do using</span></span>
<span id="cb49-12"><a href="#cb49-12" aria-hidden="true" tabindex="-1"></a><span class="co"># tail -n +2</span></span>
<span id="cb49-13"><a href="#cb49-13" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">"Number of distinct values:"</span></span>
<span id="cb49-14"><a href="#cb49-14" aria-hidden="true" tabindex="-1"></a><span class="fu">cut</span> <span class="at">-d</span> <span class="st">','</span> <span class="at">-f</span> <span class="st">"</span><span class="va">$column</span><span class="st">"</span> <span class="st">"</span><span class="va">$file</span><span class="st">"</span> <span class="kw">|</span> <span class="fu">tail</span> <span class="at">-n</span> +2 <span class="kw">|</span> <span class="fu">sort</span> <span class="kw">|</span> <span class="fu">uniq</span> <span class="kw">|</span> <span class="fu">wc</span> <span class="at">-l</span></span>
<span id="cb49-15"><a href="#cb49-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-16"><a href="#cb49-16" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">"Minimum value:"</span></span>
<span id="cb49-17"><a href="#cb49-17" aria-hidden="true" tabindex="-1"></a><span class="fu">cut</span> <span class="at">-d</span> <span class="st">','</span> <span class="at">-f</span> <span class="st">"</span><span class="va">$column</span><span class="st">"</span> <span class="st">"</span><span class="va">$file</span><span class="st">"</span> <span class="kw">|</span> <span class="fu">tail</span> <span class="at">-n</span> +2 <span class="kw">|</span> <span class="fu">sort</span> <span class="at">-n</span> <span class="kw">|</span> <span class="fu">head</span> <span class="at">-n</span> 1</span>
<span id="cb49-18"><a href="#cb49-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-19"><a href="#cb49-19" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">"Maximum value:"</span></span>
<span id="cb49-20"><a href="#cb49-20" aria-hidden="true" tabindex="-1"></a><span class="fu">cut</span> <span class="at">-d</span> <span class="st">','</span> <span class="at">-f</span> <span class="st">"</span><span class="va">$column</span><span class="st">"</span> <span class="st">"</span><span class="va">$file</span><span class="st">"</span> <span class="kw">|</span> <span class="fu">tail</span> <span class="at">-n</span> +2 <span class="kw">|</span> <span class="fu">sort</span> <span class="at">-n</span> <span class="kw">|</span> <span class="fu">tail</span> <span class="at">-n</span> 1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li>If we save the script as <code>explore.sh</code>, we can run it using:</li>
</ul>
<div class="sourceCode" id="cb50"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="fu">bash</span> explore.sh ../data/Buzzard2015_data.csv 6</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre class="bash-out"><code>Column name
Abund.n
Number of distinct values:
46
Minimum value:
1
Maximum value:
157</code></pre>
<p>This works well also for alphabetical order:</p>
<div class="sourceCode" id="cb52"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="fu">bash</span> explore.sh ../data/Buzzard2015_data.csv 3</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre class="bash-out"><code>Column name
genus
Number of distinct values:
85
Minimum value:
Acacia
Maximum value:
Zanthoxylum</code></pre>
</details>


</section>
</section>


<a onclick="window.scrollTo(0, 0); return false;" role="button" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a><div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>This exercise was slightly modified from Software Carpentry’s <a href="http://swcarpentry.github.io/shell-novice/06-script/index.html">Shell Novice tutorial</a>.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>2024, Jelmer Poelstra</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/jelmerp/pracs-sp24">
      <i class="bi bi-github" role="img">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>




</body></html>